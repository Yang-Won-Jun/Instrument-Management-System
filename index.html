<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³„ì¸¡ê¸° ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        /* ë¡œê·¸ì¸ ìŠ¤íƒ€ì¼ */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .login-container {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .login-container h2 {
            margin-bottom: 30px;
            color: #2d3a4b;
            font-size: 1.8em;
        }
        
        .login-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #d0d6e1;
            border-radius: 7px;
            font-size: 1em;
            box-sizing: border-box;
        }
        
        .login-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 7px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
        
        .login-btn:hover {
            background: linear-gradient(90deg, #2980b9, #1f5f8b);
            transform: translateY(-2px);
        }
        
        .error-message {
            color: #e74c3c;
            margin-top: 10px;
            font-size: 0.9em;
        }
        
        .main-content {
            display: block;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
        }
        .app-container {
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 230px;
            background: #2d3a4b;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            padding: 40px 0 0 0;
            box-shadow: 2px 0 8px rgba(0,0,0,0.04);
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }
        .sidebar .nav-link {
            width: 100%;
            padding: 18px 30px;
            font-size: 1.1em;
            color: #fff;
            text-decoration: none;
            display: flex;
            align-items: center;
            border-left: 4px solid transparent;
            transition: background 0.2s, border-color 0.2s;
            cursor: pointer;
        }
        .sidebar .nav-link.active {
            background: #223047;
            border-left: 4px solid #3498db;
            font-weight: bold;
        }
        .sidebar .nav-link .icon {
            margin-right: 12px;
            font-size: 1.3em;
        }
        .main-content {
            flex: 1;
            padding: 40px 5vw 40px 5vw;
            background: #f4f6fa;
            min-height: 100vh;
            margin-left: 230px;
        }
        .page-title {
            font-size: 2.2em;
            font-weight: 700;
            margin-bottom: 10px;
            color: #2d3a4b;
        }
        .section {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.04);
            padding: 32px 24px;
            margin-bottom: 32px;
        }
        /* ê·¸ë˜í”„ ìŠ¤íƒ€ì¼ */
        .bar-chart {
            width: 100%;
            max-width: 700px;
            margin: 0 auto 30px auto;
            padding: 30px 0 10px 0;
        }
        .bar-chart .bar-row {
            display: flex;
            align-items: flex-end;
            margin-bottom: 18px;
            position: relative;
        }
        .bar-chart .bar-label {
            width: 60px;
            text-align: right;
            margin-right: 18px;
            font-weight: 500;
            color: #555;
        }
        .bar-chart .bar-group {
            flex: 1;
            display: flex;
            align-items: flex-end;
            gap: 8px;
        }
        .bar {
            height: 22px;
            border-radius: 6px;
            position: relative;
            display: flex;
            align-items: center;
            transition: width 0.4s;
        }
        .bar.plan {
            background: linear-gradient(90deg, #74b9ff, #0984e3);
            min-width: 10px;
        }
        .bar.actual {
            background: linear-gradient(90deg, #55efc4, #00b894);
            min-width: 10px;
        }
        .bar-value {
            margin-left: 8px;
            font-size: 0.95em;
            color: #333;
            font-weight: 500;
        }
        .bar-achieve {
            margin-left: 16px;
            font-size: 0.95em;
            color: #e67e22;
            font-weight: 700;
        }
        .bar-chart .bar-row:last-child {
            margin-bottom: 0;
        }
        .bar-chart-legend {
            display: flex;
            gap: 24px;
            justify-content: flex-end;
            margin-bottom: 10px;
        }
        .bar-chart-legend span {
            display: flex;
            align-items: center;
            font-size: 0.98em;
            color: #555;
        }
        .bar-chart-legend .legend-box {
            width: 18px;
            height: 12px;
            border-radius: 3px;
            margin-right: 7px;
            display: inline-block;
        }
        .legend-plan { background: linear-gradient(90deg, #74b9ff, #0984e3); }
        .legend-actual { background: linear-gradient(90deg, #55efc4, #00b894); }
        /* í¼ ìŠ¤íƒ€ì¼ */
        .form-group { margin-bottom: 18px; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: 500; }
        .form-group input, .form-group select {
            width: 100%; padding: 12px; border: 1.5px solid #d0d6e1; border-radius: 7px; font-size: 1em;
        }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #3498db; }
        .btn {
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: background 0.2s;
            margin-top: 10px;
        }
        .btn:hover { background: linear-gradient(90deg, #2980b9, #3498db); }
        /* ì´ë ¥ê´€ë¦¬ */
        .instrument-list { margin-top: 10px; }
        .instrument-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px 18px;
            margin-bottom: 10px;
            border-left: 4px solid #3498db;
            cursor: pointer;
            transition: background 0.2s;
        }
        .instrument-item:hover { background: #eaf6ff; }
        .history-list { margin-top: 18px; }
        .history-year { font-weight: bold; color: #2d3a4b; margin-top: 18px; }
        .history-entry { margin-left: 18px; margin-bottom: 8px; }
        /* ì—°ë„ë³„ í˜„í™© */
        .year-summary {
            display: flex;
            gap: 30px;
            justify-content: center;
            margin: 30px 0 0 0;
        }
        .year-summary .summary-box {
            background: #f0f4fa;
            border-radius: 10px;
            padding: 18px 32px;
            min-width: 180px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .year-summary .summary-title {
            color: #2980b9;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .year-summary .summary-value {
            font-size: 2em;
            font-weight: bold;
            color: #2d3a4b;
        }
        @media (max-width: 900px) {
            .main-content { padding: 20px 2vw; }
            .sidebar { width: 60px; padding: 20px 0 0 0; }
            .sidebar .nav-link { padding: 14px 10px; font-size: 1em; justify-content: center; }
            .sidebar .nav-link .icon { margin-right: 0; }
            .sidebar .nav-link span { display: none; }
            .year-summary { flex-direction: column; gap: 10px; }
        }
        .pdf-link { color: #e67e22; text-decoration: underline; cursor: pointer; font-weight: 500; }
        /* ê³„ì¸¡ê¸° List í…Œì´ë¸” ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .instrument-list-container {
            overflow-x: auto;
            max-width: 100%;
        }
        .instrument-list-table {
            min-width: 1200px;
            font-size: 0.9em;
        }
        .instrument-list-table input,
        .instrument-list-table select {
            width: 100%;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .instrument-list-table input[type="date"] {
            width: 120px;
        }
        .instrument-list-table input[type="number"] {
            width: 60px;
        }
        .instrument-list-table th {
            white-space: nowrap;
            padding: 8px 4px;
        }
        .instrument-list-table td {
            padding: 4px;
        }
    </style>
    <script>
    // í•œê¸€ í°íŠ¸ ê´€ë ¨ ì½”ë“œ ì œê±° - jsPDF ì˜¤ë¥˜ ë°©ì§€
    </script>
</head>
<body>
    <!-- ë¡œê·¸ì¸ ì˜¤ë²„ë ˆì´ -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-container">
            <h2>ğŸ” ê³„ì¸¡ê¸° ê´€ë¦¬ ì‹œìŠ¤í…œ</h2>
            <form id="loginForm" onsubmit="handleLogin(event)">
                <input type="text" id="username" class="login-input" placeholder="ì‚¬ìš©ìëª…" required>
                <input type="password" id="password" class="login-input" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
                <button type="submit" class="login-btn">ë¡œê·¸ì¸</button>
            </form>
            <div id="loginError" class="error-message" style="display: none;"></div>
        </div>
    </div>

    <div class="app-container">
    <nav class="sidebar" style="padding:0; width:230px;">
        <div style="width:230px; height:100px; margin:0; padding:0; display:flex; align-items:center; justify-content:center;">
            <img src="Image/isu-logo.png" alt="ISU SPECIALTY CHEMICAL"
                 style="width:230px; height:100px; display:block; object-fit:contain; margin:0; padding:0;">
        </div>
        <a class="nav-link active" id="nav-home" data-page="home" style="padding:0 12px; font-size:1em; height:90px; line-height:90px;"><span class="icon">ğŸ </span><span>í™ˆ</span></a>
        <a class="nav-link" id="nav-register" data-page="register" style="padding:0 12px; font-size:1em; height:90px; line-height:90px;"><span class="icon">ğŸ“</span><span>ê³„ì¸¡ê¸° ë“±ë¡</span></a>
        <a class="nav-link" id="nav-list" data-page="list" style="padding:0 12px; font-size:1em; height:90px; line-height:90px;"><span class="icon">ğŸ“‹</span><span>ê³„ì¸¡ê¸° List</span></a>
        <a class="nav-link" id="nav-status" data-page="status" style="padding:0 12px; font-size:1em; height:90px; line-height:90px;"><span class="icon">ğŸ“Š</span><span>ê³„ì¸¡ê¸° ê²€êµì • í˜„í™©</span></a>
        <a class="nav-link" id="nav-history" data-page="history" style="padding:0 12px; font-size:1em; height:90px; line-height:90px;"><span class="icon">ğŸ“š</span><span>ê³„ì¸¡ê¸° ì´ë ¥ê´€ë¦¬</span></a>
        
        <!-- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
        <div style="margin-top: auto; padding: 20px;">
            <button onclick="logout()" style="width: 100%; padding: 12px; background: linear-gradient(90deg, #e74c3c, #c0392b); color: white; border: none; border-radius: 7px; font-size: 1em; cursor: pointer;">
                ğŸšª ë¡œê·¸ì•„ì›ƒ
            </button>
        </div>
    </nav>
    <main class="main-content">
        <!-- ê³µí†µ í—¤ë” ì œê±°ë¨ -->
        
        <!-- í™ˆí™”ë©´ -->
        <section id="page-home" class="section">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                <div class="page-title">ê³„ì¸¡ê¸° ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
                <div id="current-date" style="font-size:1.1em;color:#666;font-weight:500;"></div>
            </div>
            
            <!-- ì „ì²´ ê³„íš ëŒ€ë¹„ ì‹¤ì  ê°€ë¡œ ë§‰ëŒ€ ê·¸ë˜í”„ -->
            <div style="margin-bottom:30px; padding:25px; background:#f8f9fa; border-radius:12px; max-width:720px; margin-left:auto; margin-right:auto; display:flex; flex-direction:column; align-items:center;">
                <h3 style="margin-bottom:20px; color:#2d3a4b; font-size:1.3em; text-align:center;" id="overall-progress-title">ì „ì²´ ê³„íš ëŒ€ë¹„ ì‹¤ì </h3>
                <div id="home-overall-progress" style="margin-bottom:15px; width:100%;"></div>
                <div id="home-overall-percentage" style="text-align:center; font-size:1.2em; font-weight:600; color:#3498db;"></div>
            </div>
            
            <!-- ì›”ë³„ ê³„íš ëŒ€ë¹„ ì‹¤ì  -->
            <div style="margin-bottom:30px;">
                <h3 style="margin-bottom:20px; color:#2d3a4b; font-size:1.2em;">ì›”ë³„ ê³„íš ëŒ€ë¹„ ì‹¤ì </h3>
                <div class="bar-chart-legend">
                    <span><span class="legend-box legend-plan"></span>ê³„íš</span>
                    <span><span class="legend-box legend-actual"></span>ì‹¤ì </span>
                </div>
                <div class="bar-chart" id="home-bar-chart"></div>
                <div style="text-align:right; margin-top:10px;">
                    <a href="#" id="more-status-link" style="color:#2980b9; text-decoration:underline; font-weight:500;">+ ë”ë³´ê¸°</a>
                </div>
            </div>
            
            <div class="year-summary" id="home-year-summary"></div>
            <div class="section" style="margin-top:30px;">
                <div style="font-weight:600; margin-bottom:10px;">ê³„ì¸¡ê¸° ê²€ìƒ‰</div>
                <input type="text" id="search-instrument" placeholder="ê³„ì¸¡ê¸°ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" style="width:250px; padding:8px; border-radius:6px; border:1.5px solid #d0d6e1;">
                <div id="search-result" style="margin-top:15px;"></div>
            </div>
        </section>
        <!-- ê³„ì¸¡ê¸° ë“±ë¡ -->
        <section id="page-register" class="section" style="display:none;">
            <div class="page-title">ê³„ì¸¡ê¸° ë“±ë¡</div>
            
            <!-- Excel ì¼ê´„ ë“±ë¡ ì„¹ì…˜ ì¶”ê°€ -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                <h3 style="margin-top: 0; color: #2d3a4b;">ğŸ“Š Excel íŒŒì¼ ì¼ê´„ ë“±ë¡</h3>
                <p style="color: #666; margin-bottom: 15px;">Excel íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ê³„ì¸¡ê¸°ë¥¼ ì¼ê´„ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                
                <div style="margin-bottom: 15px;">
                    <label for="excel-file" style="display: block; margin-bottom: 5px; font-weight: 500;">Excel/CSV íŒŒì¼ ì„ íƒ:</label>
                    <input type="file" id="excel-file" accept=".xlsx,.xls,.csv" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" onchange="resetExcelPreview()">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <button type="button" onclick="uploadExcelFile()" class="btn" style="background: linear-gradient(90deg, #27ae60, #2ecc71);">
                        ğŸ“¤ Excel íŒŒì¼ ì—…ë¡œë“œ ë° ì¼ê´„ ë“±ë¡
                    </button>
                </div>
                
                <div id="excel-preview" style="display: none; margin-top: 15px;">
                    <h4>ğŸ“‹ ì—…ë¡œë“œëœ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°</h4>
                    <div id="excel-data-preview" style="max-height: 300px; overflow-y: auto; background: white; border: 1px solid #ddd; border-radius: 4px; padding: 10px;"></div>
                    <button type="button" onclick="confirmExcelUpload()" class="btn" style="background: linear-gradient(90deg, #3498db, #2980b9); margin-top: 10px;">
                        âœ… ì¼ê´„ ë“±ë¡ í™•ì¸
                    </button>
                </div>
            </div>
            
            <div style="border-top: 2px solid #e0e0e0; padding-top: 20px; margin-top: 20px;">
                <h3 style="margin-top: 0; color: #2d3a4b;">ğŸ“ ê°œë³„ ê³„ì¸¡ê¸° ë“±ë¡</h3>
                <form id="register-form">
                <div class="form-group"><label>ê³„ì¸¡ê¸°ëª…</label><input type="text" id="reg-name" required></div>
                <div class="form-group"><label>Service</label><input type="text" id="reg-service" required></div>
                <div class="form-group"><label>ê³„ì¸¡ê¸° ìœ í˜•</label><input type="text" id="reg-type" required></div>
                <div class="form-group">
                  <label>ë“±ë¡ ì—°ë„</label>
                  <select id="reg-year" required onchange="updateCalibrationNumber()">
                  </select>
                </div>
                <div class="form-group">
                  <label>êµì •ë²ˆí˜¸</label>
                  <div style="display:flex;align-items:center;">
                    <span id="reg-year-prefix" style="margin-right:4px;font-weight:bold;color:#2980b9;"></span>
                    <span style="margin-right:2px; font-weight:bold; color:#2980b9;">(ê³„)-</span>
                    <input type="text" id="reg-num" required placeholder="ìˆ«ìë§Œ ì…ë ¥ (ì˜ˆ: 001)" style="flex:1;">
                  </div>
                </div>
                <div class="form-group"><label>êµì •ì¼</label><input type="date" id="reg-date" required></div>
                <div class="form-group"><label>êµì •ì£¼ê¸°</label><div style="display:flex;align-items:center;"><input type="number" id="reg-cycle" min="1" required style="width:80px;"><span style="margin-left:6px;">ë…„</span></div></div>
                <div class="form-group"><label>ì°¨ê¸° êµì • ì˜ˆì •ì¼</label><input type="date" id="reg-next-date" readonly></div>
                <div class="form-group">
                  <label>í—ˆìš©ì˜¤ì°¨</label>
                  <div style="display:flex;align-items:center;gap:8px;">
                    <span style="font-size:1.2em;">Â±</span>
                    <input type="text" id="reg-allow-error" required style="width:80px;">
                    <select id="reg-measurement-type" style="width:100px;">
                      <option value="">ì„ íƒ</option>
                      <option value="ì˜¨ë„">ì˜¨ë„</option>
                      <option value="ìœ ëŸ‰">ìœ ëŸ‰</option>
                      <option value="ë ˆë²¨">ë ˆë²¨</option>
                      <option value="ì••ë ¥">ì••ë ¥</option>
                    </select>
                    <select id="reg-unit" style="width:80px;" onchange="toggleCustomUnit()">
                      <option value="">ë‹¨ìœ„</option>
                    </select>
                    <input type="text" id="reg-custom-unit" placeholder="ì§ì ‘ì…ë ¥" style="width:80px;display:none;">
                  </div>
                </div>
                <div class="form-group">
                  <label>ê²€êµì • êµ¬ë¶„</label>
                  <select id="reg-calib-type" required onchange="toggleExternalFields()">
                    <option value="ìì²´">ìì²´ ê²€êµì •</option>
                    <option value="ì™¸ë¶€">ì™¸ë¶€ ê²€êµì •</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>ì‚¬ìš© ê²€êµì •ê¸°</label>
                  <input type="text" id="reg-calibration-equipment" required>
                </div>
                <button type="submit" class="btn">ë“±ë¡</button>
            </form>
        </section>
        <!-- ê³„ì¸¡ê¸° ê²€êµì • í˜„í™© -->
        <section id="page-status" class="section" style="display:none;">
            <div class="page-title">ê³„ì¸¡ê¸° ê²€êµì • í˜„í™©</div>
            <div style="margin-bottom:18px;display:flex;align-items:center;gap:10px;">
                <label for="status-year">ì—°ë„ ì„ íƒ:</label>
                <select id="status-year" onchange="renderStatusList();renderStatusInputs();renderStatusChart();renderHomeYearSummary();">
                    <option value="2025">2025</option>
                </select>
            </div>
            <div id="status-instrument-list"></div>
            <form id="status-form" style="margin-top:30px;">
                <div style="margin-bottom:18px;">ì›”ë³„ ê³„íš ë° ì‹¤ì ì„ ì…ë ¥í•˜ì„¸ìš”.</div>
                <div id="status-inputs"></div>
                <button type="submit" class="btn">ì €ì¥</button>
            </form>
            <div class="bar-chart-legend" style="margin-top:30px;">
                <span><span class="legend-box legend-plan"></span>ê³„íš</span>
                <span><span class="legend-box legend-actual"></span>ì‹¤ì </span>
            </div>
            <div class="bar-chart" id="status-bar-chart"></div>
        </section>
        <!-- ê³„ì¸¡ê¸° ì´ë ¥ê´€ë¦¬ -->
        <section id="page-history" class="section" style="display:none;">
            <div class="page-title">ê³„ì¸¡ê¸° ì´ë ¥ê´€ë¦¬</div>
            <div class="instrument-list" id="history-instrument-list"></div>
            <div id="history-detail" style="display:block; margin-top:10px; border:2px solid red; background:#fff;"></div>
        </section>
        <!-- ê³„ì¸¡ê¸° List -->
        <section id="page-list" class="section" style="display:none;">
            <div class="page-title">ê³„ì¸¡ê¸° List</div>
            <div style="margin-bottom:18px;display:flex;align-items:center;gap:10px;justify-content:space-between;">
                <div style="display:flex;align-items:center;gap:10px;">
                    <label for="list-year">ì—°ë„ ì„ íƒ:</label>
                    <select id="list-year" onchange="renderInstrumentList();"></select>
                </div>
                <div style="display:flex;align-items:center;gap:10px;">
                    <button class="btn" id="edit-mode-btn" onclick="toggleEditMode()" disabled>ìˆ˜ì •</button>
                    <button class="btn" id="save-btn" onclick="saveInstrumentListChanges()" style="display:none;">ì €ì¥</button>
                    <button class="btn" id="delete-btn" onclick="deleteSelectedInstruments()" style="background:linear-gradient(90deg, #e74c3c, #c0392b);" disabled>ì‚­ì œ</button>
                </div>
            </div>
            <div class="instrument-list-container">
                <div id="instrument-list-table"></div>
            </div>
        </section>
    </main>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
<script src="NotoSansKR-VariableFont_wght-normal.js"></script>
<script>
// ë¡œê·¸ì¸ ì²˜ë¦¬ í•¨ìˆ˜
function handleLogin(event) {
    event.preventDefault();
    
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const errorDiv = document.getElementById('loginError');
    
    // ê°„ë‹¨í•œ ë¡œê·¸ì¸ ê²€ì¦ (ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì„œë²„ì—ì„œ ê²€ì¦í•´ì•¼ í•¨)
    if (username === 'admin' && password === '1234') {
        // ë¡œê·¸ì¸ ì„±ê³µ
        localStorage.setItem('isLoggedIn', 'true');
        showMainContent();
    } else {
        // ë¡œê·¸ì¸ ì‹¤íŒ¨
        errorDiv.textContent = 'ì‚¬ìš©ìëª… ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
        errorDiv.style.display = 'block';
    }
}

// ë©”ì¸ ì½˜í…ì¸  í‘œì‹œ í•¨ìˆ˜
function showMainContent() {
    document.getElementById('loginOverlay').style.display = 'none';
    document.querySelector('.app-container').style.display = 'flex';
    
    // ê¸°ì¡´ ì´ˆê¸°í™” í•¨ìˆ˜ë“¤ í˜¸ì¶œ
    initializeApp();
}

// ì•± ì´ˆê¸°í™” í•¨ìˆ˜
function initializeApp() {
    console.log('ì•± ì´ˆê¸°í™” ì‹œì‘');
    
    try {
        // ë„¤ë¹„ê²Œì´ì…˜ ë§í¬ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const page = this.getAttribute('data-page');
                showPage(page);
            });
        });
        
        // ë”ë³´ê¸° ë§í¬ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        const moreStatusLink = document.getElementById('more-status-link');
        if (moreStatusLink) {
            moreStatusLink.addEventListener('click', function(e) {
                e.preventDefault();
                showPage('status');
            });
        }
        
        // ê¸°ë³¸ ë°ì´í„° ì´ˆê¸°í™”
        if (!instrumentsByYear || Object.keys(instrumentsByYear).length === 0) {
            instrumentsByYear = {"2025": []};
            localStorage.setItem('instrumentsByYear', JSON.stringify(instrumentsByYear));
        }

        // deleted: true ë°ì´í„° ì™„ì „ ì‚­ì œ
        Object.keys(instrumentsByYear).forEach(year => {
            instrumentsByYear[year] = (instrumentsByYear[year] || []).filter(inst => !inst.deleted);
        });
        localStorage.setItem('instrumentsByYear', JSON.stringify(instrumentsByYear));
        
        // ì—°ë„ ì˜µì…˜ ì´ˆê¸°í™”
        if (typeof initializeYearOptions === 'function') {
            initializeYearOptions();
        }
        
        // êµì •ë²ˆí˜¸ ì ‘ë‘ì‚¬ ì´ˆê¸°í™”
        if (typeof updateCalibrationNumber === 'function') {
            updateCalibrationNumber();
        }
        
        // í™ˆ í™”ë©´ ì´ˆê¸°í™”
        if (typeof displayCurrentDate === 'function') {
            displayCurrentDate();
        }
        if (typeof renderHomeChart === 'function') {
            renderHomeChart();
        }
        if (typeof renderHomeOverallProgress === 'function') {
            renderHomeOverallProgress();
        }
        if (typeof renderHomeYearSummary === 'function') {
            renderHomeYearSummary();
        }
        
        // ê²€ìƒ‰ ê¸°ëŠ¥ ì´ˆê¸°í™”
        const searchInput = document.getElementById('search-instrument');
        if (searchInput) {
            searchInput.oninput = function(){
                const q = searchInput.value.trim();
                if(!q){
                    document.getElementById('search-result').innerHTML='';
                    return;
                }
                const currentYear = new Date().getFullYear().toString();
                const list = instrumentsByYear[currentYear]||[];
                const found = list.find(inst=>inst.name===q);
                if(!found){
                    document.getElementById('search-result').innerHTML='<span style="color:#888;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</span>';
                    return;
                }
                document.getElementById('search-result').innerHTML = `
                    <div style='background:#f8f9fa;padding:18px;border-radius:10px;'>
                        <div><b>ê³„ì¸¡ê¸°ëª…:</b> ${found.name}</div>
                        <div><b>Service:</b> ${found.service}</div>
                        <div><b>ìœ í˜•:</b> ${found.type}</div>
                        <div><b>êµì •ë²ˆí˜¸:</b> ${found.num}</div>
                        <div><b>êµì •ì¼:</b> ${found.date}</div>
                        <div><b>êµì •ì£¼ê¸°:</b> ${found.cycle}</div>
                        <div><b>ì°¨ê¸° êµì • ì˜ˆì •ì¼:</b> ${found.nextDate}</div>
                        <div><b>í—ˆìš©ì˜¤ì°¨:</b> Â±${found.allowError}${found.unit ? ' ' + found.unit : ''}</div>
                        <div><b>ê²€êµì • ì¼ì:</b> ${found.calibDate||'-'}</div>
                        <div><b>ìµœëŒ€ì˜¤ì°¨:</b> ${found.maxError||'-'}</div>
                        <div><b>ê²€êµì • ê²°ê³¼:</b> ${found.result||'-'}</div>
                    </div>
                `;
            }
        }
        
        console.log('ì•± ì´ˆê¸°í™” ì™„ë£Œ');
    } catch (error) {
        console.error('ì•± ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜:', error);
    }
}

// ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
function logout() {
    localStorage.removeItem('isLoggedIn');
    location.reload();
}

// ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ë° ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
    console.log('í˜ì´ì§€ ë¡œë“œ ì‹œì‘');
    
    // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
    const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
    
    // ë””ë²„ê¹…: ë¡œê·¸ì¸ ìƒíƒœ ì¶œë ¥
    console.log('ë¡œê·¸ì¸ ìƒíƒœ:', isLoggedIn);
    
    if (isLoggedIn) {
        // ì´ë¯¸ ë¡œê·¸ì¸ëœ ê²½ìš°
        console.log('ì´ë¯¸ ë¡œê·¸ì¸ë¨ - ë©”ì¸ ì½˜í…ì¸  í‘œì‹œ');
        showMainContent();
    } else {
        // ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ê²½ìš°
        console.log('ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ - ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ');
        document.querySelector('.app-container').style.display = 'none';
        document.getElementById('loginOverlay').style.display = 'flex';
    }
});

// SPA ë¼ìš°íŒ…
function showPage(page) {
    try {
        console.log('í˜ì´ì§€ ì „í™˜:', page);
        
        document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        
        if(page==='register') {
            document.getElementById('page-register').style.display = '';
            document.getElementById('nav-register').classList.add('active');
        } else if(page==='list') {
            document.getElementById('page-list').style.display = '';
            document.getElementById('nav-list').classList.add('active');
            renderInstrumentList();
        } else if(page==='status') {
            document.getElementById('page-status').style.display = '';
            document.getElementById('nav-status').classList.add('active');
            renderStatusList();
            renderStatusInputs();
            renderStatusChart();
        } else if(page==='history') {
            document.getElementById('page-history').style.display = '';
            document.getElementById('nav-history').classList.add('active');
            renderHistoryList();
        } else {
            document.getElementById('page-home').style.display = '';
            document.getElementById('nav-home').classList.add('active');
            displayCurrentDate();
            renderHomeChart();
            renderHomeOverallProgress();
            renderHomeYearSummary();
        }
        document.getElementById('history-detail').style.display = 'none';
        
        console.log('í˜ì´ì§€ ì „í™˜ ì™„ë£Œ:', page);
    } catch (error) {
        console.error('í˜ì´ì§€ ì „í™˜ ì˜¤ë¥˜:', error);
        alert('í˜ì´ì§€ ì „í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
    }
}
// ì›”ë³„ ê³„íš/ì‹¤ì  ë°ì´í„°(ì—°ë„ë³„)
let statusDataByYear = {
    '2025': [
        {month:'1ì›”', plan:10, actual:8},
        {month:'2ì›”', plan:12, actual:12},
        {month:'3ì›”', plan:15, actual:13},
        {month:'4ì›”', plan:14, actual:10},
        {month:'5ì›”', plan:16, actual:15},
        {month:'6ì›”', plan:18, actual:17},
        {month:'7ì›”', plan:20, actual:19},
        {month:'8ì›”', plan:15, actual:14},
        {month:'9ì›”', plan:13, actual:12},
        {month:'10ì›”', plan:17, actual:16},
        {month:'11ì›”', plan:19, actual:18},
        {month:'12ì›”', plan:21, actual:20}
    ]
};

// í˜„ì¬ ì„ íƒëœ ì—°ë„ì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
function getCurrentStatusData() {
    const year = document.getElementById('status-year').value;
    if (!statusDataByYear[year]) {
        // í•´ë‹¹ ì—°ë„ì˜ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ë°ì´í„° ìƒì„±
        statusDataByYear[year] = [
            {month:'1ì›”', plan:0, actual:0},
            {month:'2ì›”', plan:0, actual:0},
            {month:'3ì›”', plan:0, actual:0},
            {month:'4ì›”', plan:0, actual:0},
            {month:'5ì›”', plan:0, actual:0},
            {month:'6ì›”', plan:0, actual:0},
            {month:'7ì›”', plan:0, actual:0},
            {month:'8ì›”', plan:0, actual:0},
            {month:'9ì›”', plan:0, actual:0},
            {month:'10ì›”', plan:0, actual:0},
            {month:'11ì›”', plan:0, actual:0},
            {month:'12ì›”', plan:0, actual:0}
        ];
    }
    return statusDataByYear[year];
}
// ê³„ì¸¡ê¸° ë°ì´í„°(ì—°ë„ë³„)
// localStorageì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ë˜ëŠ” ê¸°ë³¸ê°’ ì„¤ì •
let instrumentsByYear;
try {
    const savedData = localStorage.getItem('instrumentsByYear');
    if (savedData) {
        instrumentsByYear = JSON.parse(savedData);
        console.log('localStorageì—ì„œ ë°ì´í„° ë¡œë“œ:', instrumentsByYear);
    } else {
        instrumentsByYear = {"2025": []};
        console.log('ê¸°ë³¸ ë°ì´í„°ë¡œ ì´ˆê¸°í™”');
    }
} catch (error) {
    console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
    instrumentsByYear = {"2025": []};
    localStorage.setItem('instrumentsByYear', JSON.stringify(instrumentsByYear));
}

// ê¸°ì¡´ ë°ì´í„°ì— ID ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
function addIdsToExistingInstruments() {
    Object.keys(instrumentsByYear).forEach(year => {
        const list = instrumentsByYear[year] || [];
        list.forEach(inst => {
            if (!inst.id) {
                inst.id = Date.now().toString() + Math.random().toString(36).substr(2, 9);
            }
        });
    });
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ì¡´ ë°ì´í„°ì— ID ì¶”ê°€
addIdsToExistingInstruments();

// í˜„ì¬ ë‚ ì§œ í‘œì‹œ í•¨ìˆ˜
function displayCurrentDate() {
    const now = new Date();
    const year = now.getFullYear();
    const month = now.getMonth() + 1;
    const day = now.getDate();
    const dateElement = document.getElementById('current-date');
    if (dateElement) {
        dateElement.textContent = `${year}ë…„ ${month}ì›” ${day}ì¼`;
    }
}
// í™ˆí™”ë©´ ê·¸ë˜í”„
function renderHomeChart() {
    const chart = document.getElementById('home-bar-chart');
    chart.innerHTML = '';
    const statusData = getCurrentStatusData();
    statusData.forEach(row => {
        const achieve = row.plan ? Math.round(row.actual/row.plan*100) : 0;
        chart.innerHTML += `
            <div class="bar-row">
                <div class="bar-label">${row.month}</div>
                <div class="bar-group">
                    <div class="bar plan" style="width:${row.plan*10}px;" title="ê³„íš">${row.plan}</div>
                </div>
                <div class="bar-group">
                    <div class="bar actual" style="width:${row.actual*10}px;" title="ì‹¤ì ">${row.actual}</div>
                    <span class="bar-achieve">${achieve}%</span>
                </div>
            </div>
        `;
    });
    
    // ì „ì²´ ì§„í–‰ë¥  ê·¸ë˜í”„ë„ ì—…ë°ì´íŠ¸
    renderHomeOverallProgress();
}
// í™ˆí™”ë©´ ì—°ë„ë³„ í˜„í™©
function renderHomeYearSummary() {
    const currentYear = new Date().getFullYear().toString();

    // í˜„ì¬ ì—°ë„ê¹Œì§€ ë“±ë¡ëœ ëª¨ë“  ê³„ì¸¡ê¸°ë¥¼ ìˆ˜ì§‘
    let allInstruments = [];
    Object.keys(instrumentsByYear).forEach(year => {
        if (parseInt(year) <= parseInt(currentYear)) {
            const yearList = instrumentsByYear[year] || [];
            allInstruments = allInstruments.concat(yearList);
        }
    });

    // ì‚­ì œëœ ê³„ì¸¡ê¸°(ì´ìƒí•œ ë°ì´í„°, deleted:true í¬í•¨) ì œì™¸
    const validInstruments = allInstruments.filter(i => i && i.num && i.name && !i.deleted);

    const total = validInstruments.length;
    const completed = validInstruments.filter(i => isCompleted(i, currentYear)).length;
    const scheduled = validInstruments.filter(i => !isCompleted(i, currentYear)).length;

    document.getElementById('home-year-summary').innerHTML = `
        <div class="summary-box">
            <div class="summary-title">${currentYear}ë…„ ë“±ë¡ ê³„ì¸¡ê¸°</div>
            <div class="summary-value">${total}</div>
        </div>
        <div class="summary-box">
            <div class="summary-title">ê²€êµì • ì™„ë£Œ</div>
            <div class="summary-value">${completed}</div>
        </div>
        <div class="summary-box">
            <div class="summary-title">êµì • ì˜ˆì •</div>
            <div class="summary-value">${scheduled}</div>
        </div>
    `;
}
// ê³„ì¸¡ê¸° ë“±ë¡
let instruments = [];
document.getElementById('register-form').onsubmit = function(e){
    e.preventDefault();
    const name = document.getElementById('reg-name').value;
    const service = document.getElementById('reg-service').value;
    const type = document.getElementById('reg-type').value;
    const year = document.getElementById('reg-year').value.trim();
    const numSuffix = document.getElementById('reg-num').value;
    let num = year + '(ê³„)-' + numSuffix; // êµì •ë²ˆí˜¸ë¥¼ 'ë…„ë„(ê³„)-'ë¡œ ì‹œì‘í•˜ë„ë¡ ì¡°í•©
    const date = document.getElementById('reg-date').value;
    const cycle = parseInt(document.getElementById('reg-cycle').value);
    const nextDate = document.getElementById('reg-next-date').value;
    const allowError = document.getElementById('reg-allow-error').value;
    const measurementType = document.getElementById('reg-measurement-type').value;
    const unitSelect = document.getElementById('reg-unit').value;
    const customUnit = document.getElementById('reg-custom-unit').value;
    const unit = unitSelect === 'ì§ì ‘ì…ë ¥' ? customUnit : unitSelect;
    const calibTypeValue = document.getElementById('reg-calib-type').value;
    const calibType = calibTypeValue === 'ìì²´' ? 'ìì²´ ê²€êµì •' : 'ì™¸ë¶€ ê²€êµì •';
    const calibEquipment = document.getElementById('reg-calibration-equipment').value;
    
    // year, calibType ê°’ ë¡œê·¸ ì¶œë ¥
    console.log('[ë“±ë¡ ë””ë²„ê·¸] year:', year, '| calibType:', calibType);
    
    // ì™¸ë¶€ ê²€êµì •ì¸ ê²½ìš° num ê°’ì„ ë¹ˆ ë¬¸ìì—´ë¡œ ì„¤ì •
    if (calibType === 'ì™¸ë¶€ ê²€êµì •') {
        num = '';
        console.log('[ì™¸ë¶€ ê²€êµì • ë””ë²„ê·¸] êµì •ë²ˆí˜¸ë¥¼ ë¹ˆ ë¬¸ìì—´ë¡œ ì„¤ì •:', num);
    }
    
    // ì¤‘ë³µ ê²€ì‚¬
    let duplicateName = false;
    let duplicateNumber = false;
    
    // ëª¨ë“  ì—°ë„ì—ì„œ ê³„ì¸¡ê¸°ëª… ì¤‘ë³µ ê²€ì‚¬
    Object.keys(instrumentsByYear).forEach(y => {
        const list = instrumentsByYear[y] || [];
        const nameExists = list.some(inst => inst.name === name);
        if (nameExists) {
            duplicateName = true;
        }
    });
    
    // êµì •ë²ˆí˜¸ ì¤‘ë³µ ê²€ì‚¬ (ìì²´ ê²€êµì •ì¸ ê²½ìš°ë§Œ)
    if (calibType === 'ìì²´ ê²€êµì •') {
        Object.keys(instrumentsByYear).forEach(y => {
            const list = instrumentsByYear[y] || [];
            const numberExists = list.some(inst => inst.num === num);
            if (numberExists) {
                duplicateNumber = true;
            }
        });
    }
    
    // ì¤‘ë³µ ì•Œë¦¼
    if (duplicateName) {
        alert('ë™ì¼í•œ ê³„ì¸¡ê¸°ëª…ì´ ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
        return;
    }
    
    if (duplicateNumber) {
        alert('ë™ì¼í•œ êµì •ë²ˆí˜¸ê°€ ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
        return;
    }
    
    const newInst = {
        id: Date.now().toString(), 
        name, service, type, num, date, cycle, nextDate, 
        allowError, measurementType, unit,
        calibDate:'', maxError:'', result:'', year, 
        history:[], calibType, calibEquipment, file: null
    };
    
    if(!instrumentsByYear[year]) instrumentsByYear[year]=[];
    instrumentsByYear[year].push(newInst);
    
    // localStorageì— ì €ì¥
    localStorage.setItem('instrumentsByYear', JSON.stringify(instrumentsByYear));
    
    // ë“±ë¡ í›„ í•´ë‹¹ ì—°ë„ ë°°ì—´ ë¡œê·¸ ì¶œë ¥
    console.log('[ë“±ë¡ ë””ë²„ê·¸] instrumentsByYear[', year, ']:', instrumentsByYear[year]);
    
    alert('ê³„ì¸¡ê¸°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
    document.getElementById('register-form').reset();
    
    // í¼ ë¦¬ì…‹ í›„ ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ê³  êµì •ë²ˆí˜¸ ì ‘ë‘ì‚¬ ì—…ë°ì´íŠ¸
    setTimeout(() => {
        updateCalibrationNumber();
    }, 100);
    
    renderHistoryList();
    renderStatusList();
    renderHomeYearSummary();
};
document.getElementById('reg-date').onchange = document.getElementById('reg-cycle').oninput = function(){
    const date = document.getElementById('reg-date').value;
    const cycle = parseInt(document.getElementById('reg-cycle').value);
    if(date && cycle){
        const d = new Date(date);
        d.setFullYear(d.getFullYear() + cycle);
        document.getElementById('reg-next-date').value = d.toISOString().slice(0,10);
    }
};

// ì¸¡ì • ìœ í˜• ë³€ê²½ ì‹œ ë‹¨ìœ„ ì˜µì…˜ ì—…ë°ì´íŠ¸
document.addEventListener('DOMContentLoaded', function() {
    const measurementTypeSelect = document.getElementById('reg-measurement-type');
    if (measurementTypeSelect) {
        measurementTypeSelect.addEventListener('change', updateUnitOptions);
    }
});
// ê²€êµì • êµ¬ë¶„ ë³€ê²½ ì‹œ í•„ë“œ í™œì„±í™”/ë¹„í™œì„±í™” í•¨ìˆ˜ ìˆ˜ì •
function toggleExternalFields() {
    const calibType = document.getElementById('reg-calib-type').value;
    const numInput = document.getElementById('reg-num');
    const yearPrefix = document.getElementById('reg-year-prefix');
    const allowErrorInput = document.getElementById('reg-allow-error');
    const measurementTypeSelect = document.getElementById('reg-measurement-type');
    const unitSelect = document.getElementById('reg-unit');
    const calibEquipmentInput = document.getElementById('reg-calibration-equipment');
    
    if (calibType === 'ì™¸ë¶€') {
        numInput.disabled = true;
        numInput.value = '';
        yearPrefix.style.display = 'none';
        allowErrorInput.disabled = true;
        allowErrorInput.value = '';
        measurementTypeSelect.disabled = true;
        measurementTypeSelect.value = '';
        unitSelect.disabled = true;
        unitSelect.innerHTML = '<option value="">ë‹¨ìœ„</option>';
        document.getElementById('reg-custom-unit').style.display = 'none';
        document.getElementById('reg-custom-unit').disabled = true;
        calibEquipmentInput.disabled = true;
        calibEquipmentInput.value = '';
    } else {
        numInput.disabled = false;
        yearPrefix.style.display = 'inline';
        allowErrorInput.disabled = false;
        measurementTypeSelect.disabled = false;
        unitSelect.disabled = false;
        document.getElementById('reg-custom-unit').disabled = false;
        calibEquipmentInput.disabled = false;
        
        // ìì²´ ê²€êµì •ìœ¼ë¡œ ë³€ê²½ ì‹œ êµì •ë²ˆí˜¸ ì ‘ë‘ì‚¬ ì—…ë°ì´íŠ¸
        updateCalibrationNumber();
    }
}

// ì¸¡ì • ìœ í˜•ì— ë”°ë¥¸ ë‹¨ìœ„ ì˜µì…˜ ë³€ê²½ í•¨ìˆ˜
function updateUnitOptions() {
    const measurementType = document.getElementById('reg-measurement-type').value;
    const unitSelect = document.getElementById('reg-unit');
    
    // ê¸°ì¡´ ì˜µì…˜ ì œê±°
    unitSelect.innerHTML = '<option value="">ë‹¨ìœ„</option>';
    
    // ì¸¡ì • ìœ í˜•ì— ë”°ë¥¸ ë‹¨ìœ„ ì˜µì…˜ ì¶”ê°€
    const unitOptions = {
        'ì˜¨ë„': ['Â°C', 'Â°F', 'K'],
        'ìœ ëŸ‰': ['L/min', 'mÂ³/h', 'kg/h', 'gpm'],
        'ë ˆë²¨': ['mm', 'cm', 'm'],
        'ì••ë ¥': ['Pa', 'kPa', 'MPa', 'bar', 'psi', 'kg/cmÂ²', 'mmHâ‚‚O']
    };
    
    if (measurementType && unitOptions[measurementType]) {
        unitOptions[measurementType].forEach(unit => {
            const option = document.createElement('option');
            option.value = unit;
            option.textContent = unit;
            unitSelect.appendChild(option);
        });
        
        // ê³µí†µ ì˜µì…˜ ì¶”ê°€ (%ì™€ ì§ì ‘ì…ë ¥)
        const commonOptions = ['%', 'ì§ì ‘ì…ë ¥'];
        commonOptions.forEach(option => {
            const optionElement = document.createElement('option');
            optionElement.value = option;
            optionElement.textContent = option;
            unitSelect.appendChild(optionElement);
        });
    }
}

// ì§ì ‘ì…ë ¥ í† ê¸€ í•¨ìˆ˜
function toggleCustomUnit() {
    const unitSelect = document.getElementById('reg-unit');
    const customUnitInput = document.getElementById('reg-custom-unit');
    
    if (unitSelect.value === 'ì§ì ‘ì…ë ¥') {
        customUnitInput.style.display = 'inline-block';
        customUnitInput.focus();
    } else {
        customUnitInput.style.display = 'none';
        customUnitInput.value = '';
    }
}
// ê¸°ì¡´ ì™¸ë¶€ ê²€êµì • ê³„ì¸¡ê¸°ì˜ êµì •ë²ˆí˜¸ ìˆ˜ì • í•¨ìˆ˜
function fixExternalCalibrationNumbers() {
    console.log('[ë°ì´í„° ìˆ˜ì •] ì™¸ë¶€ ê²€êµì • ê³„ì¸¡ê¸° êµì •ë²ˆí˜¸ ìˆ˜ì • ì‹œì‘');
    let modified = false;
    
    Object.keys(instrumentsByYear).forEach(year => {
        const instruments = instrumentsByYear[year];
        instruments.forEach(inst => {
            if (inst.calibType === 'ì™¸ë¶€ ê²€êµì •' && inst.num && inst.num !== '') {
                console.log(`[ë°ì´í„° ìˆ˜ì •] ${inst.name}ì˜ êµì •ë²ˆí˜¸ë¥¼ "${inst.num}"ì—ì„œ ""ë¡œ ë³€ê²½`);
                inst.num = '';
                modified = true;
            }
        });
    });
    
    if (modified) {
        localStorage.setItem('instrumentsByYear', JSON.stringify(instrumentsByYear));
        console.log('[ë°ì´í„° ìˆ˜ì •] localStorageì— ìˆ˜ì •ëœ ë°ì´í„° ì €ì¥ ì™„ë£Œ');
    }
}

// ê³„ì¸¡ê¸° ê²€êµì • í˜„í™© ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ í•¨ìˆ˜ ìˆ˜ì •
function renderStatusList(){
    // ê¸°ì¡´ ì™¸ë¶€ ê²€êµì • ê³„ì¸¡ê¸° êµì •ë²ˆí˜¸ ìˆ˜ì •
    fixExternalCalibrationNumbers();
    
    const year = document.getElementById('status-year').value;
    
    // ë“±ë¡ ì—°ë„ ì´í›„ì˜ ëª¨ë“  ê³„ì¸¡ê¸°ë¥¼ í‘œì‹œ (í•´ë‹¹ ì—°ë„ì— ë“±ë¡ëœ ê³„ì¸¡ê¸° + ì´ì „ ì—°ë„ì— ë“±ë¡ëœ ê³„ì¸¡ê¸°)
    let list = [];
    const registeredYears = Object.keys(instrumentsByYear).sort();
    registeredYears.forEach(y => {
        if (parseInt(y.trim()) <= parseInt(year.trim())) {
            list = list.concat(instrumentsByYear[y] || []);
        }
    });
    
    // ë””ë²„ê¹…: ë°ì´í„° í™•ì¸
    console.log('Year:', year);
    console.log('Total instruments:', list.length);
    console.log('Instruments:', list);
    
    // ê¸°ì¡´ ë°ì´í„° í˜¸í™˜ì„±: calibTypeì´ ì—†ìœ¼ë©´ 'ìì²´'ë¡œ ì„¤ì •
    list.forEach(inst => {
        if (!inst.calibType) inst.calibType = 'ìì²´';
        if (!inst.calibEquipment) inst.calibEquipment = '';
    });
    
    // ìì²´/ì™¸ë¶€ ë¶„ë¦¬
    const internal = list.filter(i => i.calibType && i.calibType.includes('ìì²´'));
    const external = list.filter(i => i.calibType && i.calibType.includes('ì™¸ë¶€'));
    
    console.log('Internal:', internal.length);
    console.log('External:', external.length);
    
    // ì™¸ë¶€ ê²€êµì • ê³„ì¸¡ê¸°ì˜ ë²ˆí˜¸ í™•ì¸
    console.log('[ì™¸ë¶€ ê²€êµì • ë””ë²„ê·¸] ì™¸ë¶€ ê²€êµì • ê³„ì¸¡ê¸° ëª©ë¡:');
    external.forEach((inst, index) => {
        console.log(`[${index + 1}] ê³„ì¸¡ê¸°ëª…: ${inst.name}, êµì •ë²ˆí˜¸: "${inst.num}", ê²€êµì •êµ¬ë¶„: ${inst.calibType}`);
    });
    
    // ì„ì‹œ ì…ë ¥ê°’ ì €ì¥ìš© ì´ˆê¸°í™”
    if(!window._tempStatusEdits) window._tempStatusEdits = {};
    
    let html = '';
    // ìì²´ ê²€êµì • í…Œì´ë¸”
    html += `<h3>ìì²´ ê²€êµì • ê³„ì¸¡ê¸°</h3>`;
    if(internal.length === 0){
        html += '<div style="color:#888;">ë“±ë¡ëœ ìì²´ ê²€êµì • ê³„ì¸¡ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
    } else {
        html += `<table style='width:100%;border-collapse:collapse;margin-bottom:20px;font-size:12px;'>
            <thead><tr style='background:#f0f4fa;'>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ê³„ì¸¡ê¸°ëª…</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>Service</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ìœ í˜•</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>êµì •ë²ˆí˜¸</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>êµì •ì¼</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>êµì •ì£¼ê¸°</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ì°¨ê¸° êµì • ì˜ˆì •ì¼</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ê²€êµì • ì¼ì</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>í—ˆìš©ì˜¤ì°¨</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ê¸°ì¤€ê°’</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ì¸¡ì •ê°’</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ìµœëŒ€ì˜¤ì°¨</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ê²€êµì • ê²°ê³¼</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ì„±ì ì„œ ë°œê¸‰</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ì‚¬ìš© ê²€êµì •ê¸°</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ì €ì¥</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ìŠ¹ì¸</th>
            </tr></thead><tbody>`;
        internal.forEach((inst,idx)=>{
            const displayInst = getInstrumentDisplayInfo(inst, parseInt(year));
            
            // ì‹¤ì œ ì €ì¥ëœ ë°ì´í„° ìš°ì„  ì‚¬ìš©
            const yearData = inst.yearData && inst.yearData[year];
            const temp = window._tempStatusEdits[year] && window._tempStatusEdits[year][inst.num];
            
            // ì‹¤ì œ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ì„ì‹œ ë°ì´í„° ì‚¬ìš©
            const calibDate = yearData ? yearData.calibDate : (temp ? temp.calibDate : '');
            const maxError = yearData ? yearData.maxError : (temp ? temp.maxError : '');
            const result = yearData ? yearData.result : (temp ? temp.result : '');
            const approved = yearData ? yearData.approved : false;
            
            const displayNum = generateCalibrationNumber(inst.num, year);
            html += `<tr>
                <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.name}</td>
                <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.service}</td>
                <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.type}</td>
                <td style='padding:8px;border:1px solid #e0e0e0;'>${displayNum}</td>
                <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.date || '-'}</td>
                <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.cycle}ë…„</td>
                <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.nextDate || '-'}</td>
                <td style='padding:8px;border:1px solid #e0e0e0;'><input type='date' value='${calibDate}' onchange='saveTempStatusEdit("${inst.num}","calibDate",this.value)'></td>
                <td style='padding:8px;border:1px solid #e0e0e0;'><span style="font-size:1.1em;">Â±</span> ${displayInst.allowError}${displayInst.unit ? ' ' + displayInst.unit : ''}</td>
                <td style='padding:8px;border:1px solid #e0e0e0;'>
                  <div style="display:flex;flex-direction:column;gap:2px;">
                                         <div>
                       <input type='number' style='width:60px;' value='${(yearData && yearData.std1) || (temp && temp.std1) || ''}' placeholder='ê¸°ì¤€1' onchange='saveTempStatusEdit("${inst.num}","std1",this.value)'> ${inst.unit || extractUnitFromAllowError(displayInst.allowError)}
                     </div>
                     <div>
                       <input type='number' style='width:60px;' value='${(yearData && yearData.std2) || (temp && temp.std2) || ''}' placeholder='ê¸°ì¤€2' onchange='saveTempStatusEdit("${inst.num}","std2",this.value)'> ${inst.unit || extractUnitFromAllowError(displayInst.allowError)}
                     </div>
                     <div>
                       <input type='number' style='width:60px;' value='${(yearData && yearData.std3) || (temp && temp.std3) || ''}' placeholder='ê¸°ì¤€3' onchange='saveTempStatusEdit("${inst.num}","std3",this.value)'> ${inst.unit || extractUnitFromAllowError(displayInst.allowError)}
                     </div>
                  </div>
                </td>
                <td style='padding:8px;border:1px solid #e0e0e0;'>
                  <div style="display:flex;flex-direction:column;gap:2px;">
                                           <div>
                         <input type='number' style='width:60px;' value='${(yearData && yearData.meas1) || (temp && temp.meas1) || ''}' placeholder='ì¸¡ì •1' onchange='saveTempStatusEdit("${inst.num}","meas1",this.value)'> ${inst.unit || extractUnitFromAllowError(displayInst.allowError)}
                       </div>
                       <div>
                         <input type='number' style='width:60px;' value='${(yearData && yearData.meas2) || (temp && temp.meas2) || ''}' placeholder='ì¸¡ì •2' onchange='saveTempStatusEdit("${inst.num}","meas2",this.value)'> ${inst.unit || extractUnitFromAllowError(displayInst.allowError)}
                       </div>
                       <div>
                         <input type='number' style='width:60px;' value='${(yearData && yearData.meas3) || (temp && temp.meas3) || ''}' placeholder='ì¸¡ì •3' onchange='saveTempStatusEdit("${inst.num}","meas3",this.value)'> ${inst.unit || extractUnitFromAllowError(displayInst.allowError)}
                       </div>
                  </div>
                </td>
                <td style='padding:8px;border:1px solid #e0e0e0;'><input type='text' style='width:80px;' value='${maxError}' onchange='saveTempStatusEdit("${inst.num}","maxError",this.value)'></td>
                <td style='padding:8px;border:1px solid #e0e0e0;'><select onchange='saveTempStatusEdit("${inst.num}","result",this.value)'><option value=''>ì„ íƒ</option><option value='í•©ê²©' ${result==='í•©ê²©'?'selected':''}>í•©ê²©</option><option value='ë¶ˆí•©ê²©' ${result==='ë¶ˆí•©ê²©'?'selected':''}>ë¶ˆí•©ê²©</option></select></td>
                <td style='padding:8px;border:1px solid #e0e0e0;'>
            <span class='pdf-link' onclick='(function(num){
                const year = document.getElementById("status-year").value;
                let allInstruments = [];
                Object.values(instrumentsByYear).forEach(yearArr => { allInstruments = allInstruments.concat(yearArr); });
                const inst = allInstruments.find(inst => inst.num === num);
                if(inst && inst.yearData && inst.yearData[year] && inst.yearData[year].approved){
                    generatePdfKoreanWithSeal(num);
                } else {
                    generatePdfKorean(num);
                }
})("${inst.num}")'>ì„±ì ì„œ ë°œê¸‰</span></td>
                <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.calibEquipment || '-'}</td>
                <td style='padding:8px;border:1px solid #e0e0e0;'><button class='btn' style='padding:6px 16px;font-size:0.95em;' onclick='saveStatusRow("${inst.num}")'>ì €ì¥</button></td>
                <td style='padding:8px;border:1px solid #e0e0e0;'><button class='btn approve-btn' id='approve-btn-${inst.num}' style='padding:6px 16px;font-size:0.95em;background:#e74c3c;' onclick='approveStatusRow("${inst.num}")' ${approved ? 'disabled' : ''}>${approved ? 'ìŠ¹ì¸ì™„ë£Œ' : 'ìŠ¹ì¸'}</button></td>
            </tr>`;
        });
        html += '</tbody></table>';
    }
    // ì™¸ë¶€ ê²€êµì • í…Œì´ë¸”
    html += `<h3 style="margin-top:30px;">ì™¸ë¶€ ê²€êµì • ê³„ì¸¡ê¸°</h3>`;
    if(external.length === 0){
        html += '<div style="color:#888;">ë“±ë¡ëœ ì™¸ë¶€ ê²€êµì • ê³„ì¸¡ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
    } else {
        html += `<table style='width:100%;border-collapse:collapse;margin-bottom:20px;font-size:12px;'>
            <thead><tr style='background:#f0f4fa;'>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ê³„ì¸¡ê¸°ëª…</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>Service</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ìœ í˜•</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>êµì •ì¼</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>êµì •ì£¼ê¸°</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ì°¨ê¸° êµì • ì˜ˆì •ì¼</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ê²€êµì • ì¼ì</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ì„±ì ì„œ ì²¨ë¶€</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ê²€êµì • ê²°ê³¼</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ì €ì¥</th>
            </tr></thead><tbody>`;
        external.forEach((inst,idx)=>{
            const displayInst = getInstrumentDisplayInfo(inst, parseInt(year));
            
            // í˜„ì¬ ì—°ë„ì˜ íŒŒì¼ ì •ë³´ë§Œ í™•ì¸
            const currentYearFile = inst.yearFiles && inst.yearFiles[year];
            console.log('currentYearFile for', inst.num, ':', currentYearFile);
            // ì‹¤ì œ ì €ì¥ëœ ë°ì´í„° ìš°ì„  ì‚¬ìš©
            const yearData = inst.yearData && inst.yearData[year];
            const temp = window._tempStatusEdits[year] && window._tempStatusEdits[year][inst.num];
            
            // ì‹¤ì œ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ì„ì‹œ ë°ì´í„° ì‚¬ìš©
            const calibDate = yearData ? yearData.calibDate : (temp ? temp.calibDate : '');
            const result = yearData ? yearData.result : (temp ? temp.result : '');
            
            html += `<tr>
                <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.name}</td>
                <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.service}</td>
                <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.type}</td>
                <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.date || '-'}</td>
                <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.cycle}ë…„</td>
                <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.nextDate || '-'}</td>
                <td style='padding:8px;border:1px solid #e0e0e0;'><input type='date' value='${calibDate}' onchange='saveTempStatusEdit("${inst.num}","calibDate",this.value)'></td>
                <td style='padding:8px;border:1px solid #e0e0e0;'>
                  ${currentYearFile ? 
                    `<div style="display:flex;flex-direction:column;gap:5px;">
                      <span style="color:green;font-size:0.9em;">âœ“ ${currentYearFile.fileName} ì²¨ë¶€ë¨</span>
                      <input type="file" id="file-${inst.num}-${year}" onchange="saveExternalFile('${inst.num}', this.files[0], this)" style="display:none;" />
                      <button type="button" onclick="document.getElementById('file-${inst.num}-${year}').click()" style="background:#4CAF50;color:white;border:none;padding:4px 8px;border-radius:3px;font-size:0.8em;cursor:pointer;">íŒŒì¼ ë³€ê²½</button>
                      ${currentYearFile.fileUrl && !currentYearFile.fileUrl.includes('vercel.app') ? `<a href="${currentYearFile.fileUrl}" download="${currentYearFile.fileName||'ì„±ì ì„œ.pdf'}" style="color:blue;font-size:0.9em;">ë‹¤ìš´ë¡œë“œ</a>` : ''}
                    </div>` : 
                    `<input type="file" id="file-${inst.num}-${year}" onchange="saveExternalFile('${inst.num}', this.files[0], this)" />`
                  }
                </td>
                <td style='padding:8px;border:1px solid #e0e0e0;'><select onchange='saveTempStatusEdit("${inst.num}","result",this.value)'><option value=''>ì„ íƒ</option><option value='í•©ê²©' ${result==='í•©ê²©'?'selected':''}>í•©ê²©</option><option value='ë¶ˆí•©ê²©' ${result==='ë¶ˆí•©ê²©'?'selected':''}>ë¶ˆí•©ê²©</option></select></td>
                <td style='padding:8px;border:1px solid #e0e0e0;'><button class='btn' onclick='saveStatusRow("${inst.num}")'>ì €ì¥</button></td>
            </tr>`;
        });
        html += '</tbody></table>';
    }
    document.getElementById('status-instrument-list').innerHTML = html;
}
// ì„ì‹œ ì…ë ¥ê°’ ì €ì¥
function saveTempStatusEdit(num, key, value) {
    const year = document.getElementById('status-year').value;
    if(!window._tempStatusEdits) window._tempStatusEdits = {};
    if(!window._tempStatusEdits[year]) window._tempStatusEdits[year] = {};
    if(!window._tempStatusEdits[year][num]) window._tempStatusEdits[year][num] = {calibDate:'',maxError:'',result:'',std1:'',meas1:'',std2:'',meas2:'',std3:'',meas3:''};
    window._tempStatusEdits[year][num][key] = value;
}
// ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤ì œ ë°ì´í„°ì— ë°˜ì˜
function saveStatusRow(num) {
    const year = document.getElementById('status-year').value;
    const list = instrumentsByYear[year]||[];
    const idx = list.findIndex(inst=>inst.num===num);
    if(idx===-1) return;
    
    const temp = window._tempStatusEdits[year] && window._tempStatusEdits[year][num];
    if(temp) {
        // ì—°ë„ë³„ ë°ì´í„° ì´ˆê¸°í™”
        if(!list[idx].yearData) list[idx].yearData = {};
        
        // í˜„ì¬ ì—°ë„ì— ë°ì´í„° ì €ì¥
        list[idx].yearData[year] = {
            calibDate: temp.calibDate,
            maxError: temp.maxError,
            result: temp.result,
            std1: temp.std1 || '',
            meas1: temp.meas1 || '',
            std2: temp.std2 || '',
            meas2: temp.meas2 || '',
            std3: temp.std3 || '',
            meas3: temp.meas3 || '',
            approved: (list[idx].yearData[year] && list[idx].yearData[year].approved) || false
        };
        
        // ê²€êµì • ì¼ìê°€ ì…ë ¥ëœ ê²½ìš° ê³„ì¸¡ê¸° Listì˜ êµì •ì¼ê³¼ ì°¨ê¸° êµì • ì˜ˆì •ì¼ ì—…ë°ì´íŠ¸
        if(temp.calibDate && temp.calibDate.trim() !== '') {
            // êµì •ì¼ ì—…ë°ì´íŠ¸
            list[idx].calibDate = temp.calibDate;
            
            // ì°¨ê¸° êµì • ì˜ˆì •ì¼ ê³„ì‚° (ê²€êµì • ì¼ì + êµì •ì£¼ê¸°)
            const calibDate = new Date(temp.calibDate);
            const nextCalibDate = new Date(calibDate);
            nextCalibDate.setFullYear(nextCalibDate.getFullYear() + list[idx].cycle);
            list[idx].nextDate = nextCalibDate.toISOString().slice(0, 10);
        }
        
        // ì„ì‹œ ë°ì´í„° ì‚­ì œ
        delete window._tempStatusEdits[year][num];
        
        // localStorageì— ì €ì¥
        localStorage.setItem('instrumentsByYear', JSON.stringify(instrumentsByYear));
    }
    alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
    renderStatusList();
    renderHomeYearSummary();
    renderStatusChart();
    renderInstrumentList(); // ê³„ì¸¡ê¸° Listë„ ì—…ë°ì´íŠ¸
}
function updateAllowError(idx, val){
    const year = document.getElementById('status-year').value;
    instrumentsByYear[year][idx].allowError = val;
    renderHomeYearSummary();
}
function updateMaxError(idx, val){
    const year = document.getElementById('status-year').value;
    instrumentsByYear[year][idx].maxError = val;
    renderHomeYearSummary();
}
function updateResult(idx, val){
    const year = document.getElementById('status-year').value;
    instrumentsByYear[year][idx].result = val;
    renderHomeYearSummary();
}
function updateCalibDate(idx, val){
    const year = document.getElementById('status-year').value;
    instrumentsByYear[year][idx].calibDate = val;
    renderHomeYearSummary();
    renderStatusChart();
}
// isCompleted í•¨ìˆ˜ ìˆ˜ì • - ì™¸ë¶€ ê²€êµì •ë„ í¬í•¨
function isCompleted(inst, year){
    if (inst.calibType === "ì™¸ë¶€") {
        const yearData = inst.yearData && inst.yearData[year];
        return yearData && yearData.calibDate && yearData.result;
    } else {
        const yearData = inst.yearData && inst.yearData[year];
        return yearData && yearData.calibDate && yearData.maxError && yearData.result;
    }
}
function autoCollectStatusData(){
    const year = document.getElementById('status-year').value;
    const list = instrumentsByYear[year]||[];
    const statusData = getCurrentStatusData();
    statusData.forEach(row=>{row.plan=0;row.actual=0;});
    list.forEach(inst=>{
        if(inst.nextDate){
            const m = (new Date(inst.nextDate)).getMonth();
            if(m>=0 && m<12) statusData[m].plan++;
        }
        if(isCompleted(inst, year) && inst.yearData && inst.yearData[year] && inst.yearData[year].calibDate){
            const m = (new Date(inst.yearData[year].calibDate)).getMonth();
            if(m>=0 && m<12) statusData[m].actual++;
        }
    });
    // ìˆ˜ì§‘ëœ ë°ì´í„°ë¥¼ í•´ë‹¹ ì—°ë„ì— ì €ì¥
    statusDataByYear[year] = statusData;
    renderStatusInputs();
    renderStatusChart();
    renderHomeChart();
}
function renderStatusInputs() {
    const wrap = document.getElementById('status-inputs');
    wrap.innerHTML = '';
    const statusData = getCurrentStatusData();
    statusData.forEach((row, idx) => {
        wrap.innerHTML += `
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
                <div style="width:60px;">${row.month}</div>
                <input type="number" min="0" value="${row.plan}" style="width:80px;" onchange="updateStatusData(${idx}, 'plan', this.valueAsNumber);">
                <span style="color:#888;">ê³„íš</span>
                <input type="number" min="0" value="${row.actual}" style="width:80px;" onchange="updateStatusData(${idx}, 'actual', this.valueAsNumber);">
                <span style="color:#888;">ì‹¤ì </span>
            </div>
        `;
    });
}
// ìƒíƒœ ë°ì´í„° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
function updateStatusData(idx, field, value) {
    const year = document.getElementById('status-year').value;
    if (!statusDataByYear[year]) {
        statusDataByYear[year] = getCurrentStatusData();
    }
    statusDataByYear[year][idx][field] = value;
    renderStatusChart();
    renderHomeChart();
}

function renderStatusChart() {
    const chart = document.getElementById('status-bar-chart');
    chart.innerHTML = '';
    const statusData = getCurrentStatusData();
    statusData.forEach(row => {
        const achieve = row.plan ? Math.round(row.actual/row.plan*100) : 0;
        chart.innerHTML += `
            <div class="bar-row">
                <div class="bar-label">${row.month}</div>
                <div class="bar-group">
                    <div class="bar plan" style="width:${row.plan*10}px;" title="ê³„íš">${row.plan}</div>
                </div>
                <div class="bar-group">
                    <div class="bar actual" style="width:${row.actual*10}px;" title="ì‹¤ì ">${row.actual}</div>
                    <span class="bar-achieve">${achieve}%</span>
                </div>
            </div>
        `;
    });
}
document.getElementById('status-form').onsubmit = function(e){
    e.preventDefault();
    const year = document.getElementById('status-year').value;
    // í˜„ì¬ ì—°ë„ì˜ ë°ì´í„°ê°€ ì´ë¯¸ statusDataByYearì— ì €ì¥ë˜ì–´ ìˆìŒ
    alert(`${year}ë…„ ì›”ë³„ ê³„íš/ì‹¤ì  ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`);
};
// ì´ë ¥ê´€ë¦¬
let selectedHistoryIdx = null;

function renderHistoryList(){
    console.log('renderHistoryList ì‹¤í–‰!');
    const listElem = document.getElementById('history-instrument-list');
    listElem.innerHTML = '';
    // document.getElementById('history-detail').innerHTML = ''; // ìƒì„¸ ì˜ì—­ ë¹„ìš°ëŠ” ì½”ë“œ ì£¼ì„ ì²˜ë¦¬
    // document.getElementById('history-detail').style.display = 'none'; // ìƒì„¸ ì˜ì—­ ìˆ¨ê¸°ëŠ” ì½”ë“œ ì£¼ì„ ì²˜ë¦¬

    // ëª¨ë“  ì—°ë„ì˜ ê³„ì¸¡ê¸°ë¥¼ í•©ì¹¨
    let allInstruments = [];
    Object.values(instrumentsByYear).forEach(yearArr => {
        allInstruments = allInstruments.concat(yearArr);
    });

    // ì‚­ì œëœ ê³„ì¸¡ê¸°(ì´ìƒí•œ ë°ì´í„°, deleted:true í¬í•¨) ì œì™¸
    // ì™¸ë¶€ ê²€êµì • ê³„ì¸¡ê¸°ëŠ” numì´ ë¹ˆ ë¬¸ìì—´ì´ë¯€ë¡œ num ì¡°ê±´ ì œì™¸
    allInstruments = allInstruments.filter(inst => inst && inst.name && !inst.deleted);

    // history í•„ë“œê°€ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ë¡œ ì´ˆê¸°í™”
    allInstruments.forEach(inst => {
        if (!inst.history) inst.history = [];
    });

    // ì „ì—­ ë³€ìˆ˜ë¡œ ì €ì¥
    window._allInstrumentsForHistory = allInstruments;

    if(allInstruments.length === 0){
        listElem.innerHTML = '<div style="color:#888;">ë“±ë¡ëœ ê³„ì¸¡ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
    }
    allInstruments.forEach((inst, idx) => {
        listElem.innerHTML += `<div class="instrument-item" onclick="selectHistoryInstrument(${idx})">${inst.name} (${inst.service})</div>`;
        if (selectedHistoryIdx === idx) {
            listElem.innerHTML += `<div id="history-detail" style="margin:10px 0;">${getHistoryDetailHtml(inst, idx)}</div>`;
        }
    });
}

function selectHistoryInstrument(idx){
    selectedHistoryIdx = idx;
    renderHistoryList();
}

function getHistoryDetailHtml(inst, idx){
    let html = `<div style='font-size:1.2em;font-weight:600;color:#2980b9;'>${inst.name} (${inst.service}) ì´ë ¥</div>`;
    html += `<div style='margin-top:10px;'><button class='btn' onclick='addHistoryEntry(${idx})'>+ ì—°ë„ë³„ ì´ë ¥ ì¶”ê°€</button></div>`;
    if(inst.history.length===0){
        html += `<div style='color:#888;margin-top:10px;'>ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
    } else {
        const years = {};
        inst.history.forEach(h=>{if(!years[h.year])years[h.year]=[];years[h.year].push(h);});
        Object.keys(years).sort().forEach(y=>{
            html += `<div class='history-year'>${y}ë…„</div>`;
            years[y].forEach(h=>{
                html += `<div class='history-entry'>- ${h.desc}</div>`;
            });
        });
    }
    return html;
}
// ìµœì´ˆ ì§„ì…ì‹œ í™ˆí™”ë©´ v
initializeYearOptions(); // ì—°ë„ ì˜µì…˜ ì´ˆê¸°í™”
showPage('home');

function generatePdf(num){
    console.log('generatePdf í•¨ìˆ˜ í˜¸ì¶œë¨, num:', num);
    console.log('window.jspdf:', window.jspdf);
    console.log('window.jspdf.jsPDF:', window.jspdf?.jsPDF);
    
    const year = document.getElementById('status-year').value;
    console.log('ì„ íƒëœ ì—°ë„:', year);
    
    // ëª¨ë“  ì—°ë„ì˜ ê³„ì¸¡ê¸°ë¥¼ í•©ì³ì„œ í•´ë‹¹ ê³„ì¸¡ê¸° ì°¾ê¸°
    let allInstruments = [];
    Object.values(instrumentsByYear).forEach(yearArr => {
        allInstruments = allInstruments.concat(yearArr);
    });
    
    console.log('ì „ì²´ ê³„ì¸¡ê¸° ëª©ë¡:', allInstruments);
    const inst = allInstruments.find(inst => inst.num === num);
    console.log('ì°¾ì€ ê³„ì¸¡ê¸°:', inst);
    
    if (!inst) {
        alert('ê³„ì¸¡ê¸°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë²ˆí˜¸: ' + num);
        return;
    }
    
    if (!window.jspdf || !window.jspdf.jsPDF) {
        console.error('PDF ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨');
        alert('PDF ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.');
        return;
    }
    
    try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // í•œê¸€ í°íŠ¸ ì„¤ì • - ê¸°ë³¸ í°íŠ¸ ì‚¬ìš©í•˜ë˜ í•œê¸€ ì§€ì›
        doc.setFont('helvetica', 'normal');
        
        // ê²°ì¬ë€
        doc.setFontSize(12);
        doc.text('Manager:', 150, 15);
        doc.text('Checker:', 150, 25);
        doc.rect(170, 8, 30, 10); // ë‹´ë‹¹ì ì„œëª…ë€
        doc.rect(170, 18, 30, 10); // í™•ì¸ì ì„œëª…ë€
        // íƒ€ì´í‹€
        doc.setFontSize(18);
        doc.text('Instrument Calibration Certificate', 105, 40, {align:'center'});
        doc.setFontSize(13);
        // ì •ë³´
        let y = 60;
        doc.text(`Instrument Name: ${inst.name}`, 20, y);
        y += 12;
        doc.text(`Service: ${inst.service}`, 20, y);
        y += 12;
        doc.text(`Type: ${inst.type}`, 20, y);
        y += 12;
        doc.text(`Calibration No: ${inst.num}`, 20, y);
        y += 12;
        doc.text(`Calibration Date: ${inst.date}`, 20, y);
        y += 12;
        doc.text(`Cycle: ${inst.cycle} years`, 20, y);
        y += 12;
        doc.text(`Next Calibration: ${inst.nextDate}`, 20, y);
        y += 12;
        doc.text(`Allowable Error: Â±${inst.allowError}${inst.unit ? ' ' + inst.unit : ''}`, 20, y);
        y += 12;
        
        // í˜„ì¬ ì—°ë„ì˜ ê²€êµì • ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        const yearData = inst.yearData && inst.yearData[year];
        const calibDate = yearData ? yearData.calibDate : '';
        const maxError = yearData ? yearData.maxError : '';
        const result = yearData ? yearData.result : '';
        
        doc.text(`Calibration Date: ${calibDate || '-'}`, 20, y);
        y += 12;
        doc.text(`Max Error: ${maxError || '-'}`, 20, y);
        y += 12;
        doc.text(`Result: ${result || '-'}`, 20, y);
        // í•˜ë‹¨
        doc.setFontSize(10);
        doc.text('This certificate proves the calibration result of the instrument.', 20, 270);
        doc.save(`${inst.name}_Certificate.pdf`);
        console.log('PDF ìƒì„± ì™„ë£Œ');
    } catch (error) {
        console.error('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜:', error);
        alert('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
    }
}
// ì™¸ë¶€ ê²€êµì • íŒŒì¼ ì €ì¥ í•¨ìˆ˜ ì¶”ê°€
function saveExternalFile(num, file, input) {
    console.log('saveExternalFile called:', num, file);
    const year = document.getElementById('status-year').value;
    const list = instrumentsByYear[year]||[];
    console.log('Year:', year, 'List length:', list.length);
    console.log('Looking for num:', num, 'Type:', typeof num);
    
    let idx = -1;
    
    // ì™¸ë¶€ ê²€êµì • ê³„ì¸¡ê¸°ì˜ ê²½ìš° (numì´ ë¹ˆ ë¬¸ìì—´ì´ê±°ë‚˜ ìˆ«ìê°€ ì•„ë‹Œ ê²½ìš°)
    if (!num || num === '' || isNaN(parseInt(num))) {
        // íŒŒì¼ inputì˜ idì—ì„œ ê³„ì¸¡ê¸°ëª… ì¶”ì¶œ
        const fileId = input.id;
        console.log('File input id:', fileId);
        
        // file-{num}-{year} í˜•ì‹ì—ì„œ num ë¶€ë¶„ì´ ë¹ˆ ë¬¸ìì—´ì¸ ê²½ìš°
        // ê³„ì¸¡ê¸°ëª…ìœ¼ë¡œ ì°¾ê¸° ìœ„í•´ ë‹¤ë¥¸ ë°©ë²• ì‚¬ìš©
        const externalInstruments = list.filter(inst => inst.calibType === 'ì™¸ë¶€ ê²€êµì •');
        console.log('External instruments:', externalInstruments);
        
        if (externalInstruments.length === 1) {
            // ì™¸ë¶€ ê²€êµì • ê³„ì¸¡ê¸°ê°€ í•˜ë‚˜ë¿ì¸ ê²½ìš°
            idx = list.findIndex(inst => inst.calibType === 'ì™¸ë¶€ ê²€êµì •');
        } else {
            // ì—¬ëŸ¬ ê°œì¸ ê²½ìš° ì‚¬ìš©ìì—ê²Œ ì„ íƒí•˜ë„ë¡ í•  ìˆ˜ ìˆì§€ë§Œ, 
            // í˜„ì¬ëŠ” ì²« ë²ˆì§¸ ì™¸ë¶€ ê²€êµì • ê³„ì¸¡ê¸°ë¥¼ ì‚¬ìš©
            idx = list.findIndex(inst => inst.calibType === 'ì™¸ë¶€ ê²€êµì •');
        }
    } else {
        // ê¸°ì¡´ ë°©ì‹ (ìì²´ ê²€êµì • ê³„ì¸¡ê¸°)
        const numToFind = parseInt(num);
        idx = list.findIndex(inst => parseInt(inst.num) === numToFind);
    }
    
    console.log('Found index:', idx);
    console.log('Available instruments:', list.map(inst => ({num: inst.num, name: inst.name, calibType: inst.calibType})));
    
    if(idx !== -1 && file) {
        // ì—°ë„ë³„ íŒŒì¼ ì •ë³´ ì´ˆê¸°í™”
        if(!list[idx].yearFiles) list[idx].yearFiles = {};
        
        // ê¸°ì¡´ URL í•´ì œ
        if(list[idx].yearFiles[year] && list[idx].yearFiles[year].fileUrl) {
            URL.revokeObjectURL(list[idx].yearFiles[year].fileUrl);
        }
        
        // í˜„ì¬ ì—°ë„ì— íŒŒì¼ ì •ë³´ ì €ì¥
        list[idx].yearFiles[year] = {
            file: file,
            fileName: file.name,
            fileUrl: URL.createObjectURL(file)
        };
        console.log('Saved yearFiles:', list[idx].yearFiles);
        console.log('Saved yearFiles[year]:', list[idx].yearFiles[year]);
        localStorage.setItem('instrumentsByYear', JSON.stringify(instrumentsByYear));
        console.log('File saved successfully for year', year, ':', list[idx].yearFiles[year].fileName);
    } else {
        console.log('Failed to save file - idx:', idx, 'file:', file);
    }
    
    // ë Œë”ë§ìœ¼ë¡œ UI ì—…ë°ì´íŠ¸
    renderStatusList();
    renderHomeYearSummary();
    renderInstrumentList();
}
// ìˆ˜ì • ëª¨ë“œ í† ê¸€ í•¨ìˆ˜ ì¶”ê°€
let isEditMode = false;

function toggleEditMode() {
    const checkboxes = document.querySelectorAll('.instrument-checkbox:checked');
    if (checkboxes.length === 0) {
        alert('ìˆ˜ì •í•  ê³„ì¸¡ê¸°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }
    
    isEditMode = !isEditMode;
    const editBtn = document.getElementById('edit-mode-btn');
    const saveBtn = document.getElementById('save-btn');
    
    if (isEditMode) {
        editBtn.textContent = 'ì·¨ì†Œ';
        editBtn.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
        saveBtn.style.display = 'inline-block';
    } else {
        editBtn.textContent = 'ìˆ˜ì •';
        editBtn.style.background = 'linear-gradient(90deg, #3498db, #2980b9)';
        saveBtn.style.display = 'none';
    }
    
    renderInstrumentList();
}

// ê³„ì¸¡ê¸° List ë Œë”ë§ í•¨ìˆ˜ ìˆ˜ì • - ìˆ˜ì • ëª¨ë“œì— ë”°ë¼ í‘œì‹œ ë°©ì‹ ë³€ê²½
function renderInstrumentList() {
    console.log('=== renderInstrumentList ì‹œì‘ ===');
    console.log('í˜„ì¬ instrumentsByYear:', instrumentsByYear);
    
    // localStorageì—ì„œ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë¡œë“œí•˜ëŠ” ë¶€ë¶„ ì œê±°
    // (ë©”ëª¨ë¦¬ì˜ ìµœì‹  ë°ì´í„°ê°€ ë®ì–´ì”Œì›Œì§€ëŠ” ê²ƒì„ ë°©ì§€)
    
    // ì—°ë„ ëª©ë¡ ìƒì„±
    const years = generateYearOptions();
    const yearSelect = document.getElementById('list-year');
    const currentYear = yearSelect.value || new Date().getFullYear();
    // ì—°ë„ ì˜µì…˜ì´ ë¹„ì–´ìˆì„ ë•Œë§Œ ì´ˆê¸°í™”
    if (yearSelect.children.length === 0) {
        yearSelect.innerHTML = years.map(y => `<option value="${y}">${y}</option>`).join('');
        yearSelect.value = currentYear;
    }
    const year = yearSelect.value || currentYear;
    console.log('ì„ íƒëœ ì—°ë„:', year);
    // ë“±ë¡ ì—°ë„ ì´í›„ì˜ ëª¨ë“  ê³„ì¸¡ê¸°ë¥¼ í‘œì‹œ (í•´ë‹¹ ì—°ë„ì— ë“±ë¡ëœ ê³„ì¸¡ê¸° + ì´ì „ ì—°ë„ì— ë“±ë¡ëœ ê³„ì¸¡ê¸°)
    let list = [];
    const registeredYears = Object.keys(instrumentsByYear).sort();
    registeredYears.forEach(y => {
        if (parseInt(y.trim()) <= parseInt(year.trim())) {
            const yearData = instrumentsByYear[y] || [];
            list = list.concat(yearData);
        }
    });
    console.log('ì „ì²´ ë¦¬ìŠ¤íŠ¸:', list);
    list.sort((a, b) => (a.num || '').localeCompare(b.num || ''));
    // ìì²´/ì™¸ë¶€ ë¶„ë¦¬
    const internal = list.filter(i => i.calibType && i.calibType.includes('ìì²´'));
    const external = list.filter(i => i.calibType && i.calibType.includes('ì™¸ë¶€'));
    let html = '';
    html += `<h3>ìì²´ ê²€êµì • ê³„ì¸¡ê¸°</h3>`;
    if(internal.length === 0){
        html += '<div style="color:#888;">ë“±ë¡ëœ ìì²´ ê²€êµì • ê³„ì¸¡ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
    } else {
        html += `<table class="instrument-list-table" style='width:100%;border-collapse:collapse;margin-bottom:20px;font-size:12px;'>
            <thead><tr style='background:#f0f4fa;'>
                <th style='padding:8px;border:1px solid #e0e0e0;'><input type="checkbox" id="select-all-internal" onchange="toggleSelectAll('internal', this.checked)"></th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ê³„ì¸¡ê¸°ëª…</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>Service</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ìœ í˜•</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>êµì •ë²ˆí˜¸</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>êµì •ì¼</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>êµì •ì£¼ê¸°</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ì°¨ê¸° êµì • ì˜ˆì •ì¼</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>í—ˆìš©ì˜¤ì°¨</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ê²€êµì • êµ¬ë¶„</th>
            </tr></thead><tbody>`;
        internal.forEach((inst,idx)=>{
            const displayInst = getInstrumentDisplayInfo(inst, parseInt(year));
            const displayNum = generateCalibrationNumber(inst.num, year);
            
            // yearDataì™€ temp ë³€ìˆ˜ ì •ì˜
            const yearData = inst.yearData && inst.yearData[year];
            const temp = window._tempStatusEdits && window._tempStatusEdits[year] && window._tempStatusEdits[year][inst.num];
            const maxError = (yearData && yearData.maxError) || (temp && temp.maxError) || '';
            const result = (yearData && yearData.result) || (temp && temp.result) || '';
            
            let checked = false;
            if (isEditMode) {
                // ì²´í¬ë°•ìŠ¤ê°€ ì²´í¬ë˜ì–´ ìˆìœ¼ë©´ í™œì„±í™”
                const checkbox = document.querySelector(`.instrument-checkbox[data-type="internal"][data-index="${idx}"]`);
                checked = checkbox && checkbox.checked;
            }
            if (isEditMode) {
                html += `<tr>
                    <td style='padding:8px;border:1px solid #e0e0e0;'><input type="checkbox" class="instrument-checkbox" data-type="internal" data-index="${idx}" data-instrument-id="${inst.id}" onchange="updateButtonStates()"></td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'><input type='text' value='${displayInst.name}' onchange='updateInstrumentField(${idx},"name",this.value)' ${!checked ? "disabled" : ""}></td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'><input type='text' value='${displayInst.service}' onchange='updateInstrumentField(${idx},"service",this.value)' ${!checked ? "disabled" : ""}></td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'><input type='text' value='${displayInst.type}' onchange='updateInstrumentField(${idx},"type",this.value)' ${!checked ? "disabled" : ""}></td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'><input type='text' value='${displayNum}' onchange='updateInstrumentField(${idx},"num",this.value)' ${!checked ? "disabled" : ""}></td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'><input type='date' value='${displayInst.date}' onchange='updateInstrumentField(${idx},"date",this.value)' ${!checked ? "disabled" : ""}></td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'><input type='number' value='${displayInst.cycle}' onchange='updateInstrumentField(${idx},"cycle",this.value)' ${!checked ? "disabled" : ""}></td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'><input type='date' value='${displayInst.nextDate}' onchange='updateInstrumentField(${idx},"nextDate",this.value)' ${!checked ? "disabled" : ""}></td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'><input type='text' value='${displayInst.allowError}' onchange='updateInstrumentField(${idx},"allowError",this.value)' ${!checked ? "disabled" : ""}></td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'>
                        <select onchange='updateInstrumentField(${idx},"calibType",this.value)' ${!checked ? "disabled" : ""}>
                            <option value='ìì²´ ê²€êµì •' ${displayInst.calibType==='ìì²´ ê²€êµì •'?'selected':''}>ìì²´ ê²€êµì •</option>
                            <option value='ì™¸ë¶€ ê²€êµì •' ${displayInst.calibType==='ì™¸ë¶€ ê²€êµì •'?'selected':''}>ì™¸ë¶€ ê²€êµì •</option>
                        </select>
                    </td>
                </tr>`;
            } else {
                html += `<tr>
                    <td style='padding:8px;border:1px solid #e0e0e0;'><input type="checkbox" class="instrument-checkbox" data-type="internal" data-index="${idx}" data-instrument-id="${inst.id}" onchange="updateButtonStates()"></td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.name}</td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.service}</td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.type}</td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'>${displayNum}</td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.date || '-'}</td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.cycle}ë…„</td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.nextDate || '-'}</td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'>Â±${displayInst.allowError}${displayInst.unit ? ' ' + displayInst.unit : ''}</td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.calibType}</td>
                </tr>`;
            }
        });
        html += '</tbody></table>';
    }
    html += `<h3 style="margin-top:30px;">ì™¸ë¶€ ê²€êµì • ê³„ì¸¡ê¸°</h3>`;
    if(external.length === 0){
        html += '<div style="color:#888;">ë“±ë¡ëœ ì™¸ë¶€ ê²€êµì • ê³„ì¸¡ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
    } else {
        html += `<table class="instrument-list-table" style='width:100%;border-collapse:collapse;margin-bottom:20px;font-size:12px;'>
            <thead><tr style='background:#f0f4fa;'>
                <th style='padding:8px;border:1px solid #e0e0e0;'><input type="checkbox" id="select-all-external" onchange="toggleSelectAll('external', this.checked)"></th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ê³„ì¸¡ê¸°ëª…</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>Service</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ìœ í˜•</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>êµì •ì¼</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>êµì •ì£¼ê¸°</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ì°¨ê¸° êµì • ì˜ˆì •ì¼</th>
                <th style='padding:8px;border:1px solid #e0e0e0;'>ê²€êµì • êµ¬ë¶„</th>
            </tr></thead><tbody>`;
        external.forEach((inst,idx)=>{
            const displayInst = getInstrumentDisplayInfo(inst, parseInt(year));
            const externalIdx = internal.length + idx;
            let checked = false;
            if (isEditMode) {
                const checkbox = document.querySelector(`.instrument-checkbox[data-type="external"][data-index="${externalIdx}"]`);
                checked = checkbox && checkbox.checked;
            }
            if (isEditMode) {
                html += `<tr>
                    <td style='padding:8px;border:1px solid #e0e0e0;'><input type="checkbox" class="instrument-checkbox" data-type="external" data-index="${externalIdx}" data-instrument-id="${inst.id}" onchange="updateButtonStates()"></td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'><input type='text' value='${displayInst.name}' onchange='updateInstrumentField(${externalIdx},"name",this.value)' ${!checked ? "disabled" : ""}></td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'><input type='text' value='${displayInst.service}' onchange='updateInstrumentField(${externalIdx},"service",this.value)' ${!checked ? "disabled" : ""}></td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'><input type='text' value='${displayInst.type}' onchange='updateInstrumentField(${externalIdx},"type",this.value)' ${!checked ? "disabled" : ""}></td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'><input type='date' value='${displayInst.date}' onchange='updateInstrumentField(${externalIdx},"date",this.value)' ${!checked ? "disabled" : ""}></td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'><input type='number' value='${displayInst.cycle}' onchange='updateInstrumentField(${externalIdx},"cycle",this.value)' ${!checked ? "disabled" : ""}></td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'><input type='date' value='${displayInst.nextDate}' onchange='updateInstrumentField(${externalIdx},"nextDate",this.value)' ${!checked ? "disabled" : ""}></td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'>
                        <select onchange='updateInstrumentField(${externalIdx},"calibType",this.value)' ${!checked ? "disabled" : ""}>
                            <option value='ìì²´ ê²€êµì •' ${displayInst.calibType==='ìì²´ ê²€êµì •'?'selected':''}>ìì²´ ê²€êµì •</option>
                            <option value='ì™¸ë¶€ ê²€êµì •' ${displayInst.calibType==='ì™¸ë¶€ ê²€êµì •'?'selected':''}>ì™¸ë¶€ ê²€êµì •</option>
                        </select>
                    </td>
                </tr>`;
            } else {
                html += `<tr>
                    <td style='padding:8px;border:1px solid #e0e0e0;'><input type="checkbox" class="instrument-checkbox" data-type="external" data-index="${externalIdx}" data-instrument-id="${inst.id}" onchange="updateButtonStates()"></td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.name}</td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.service}</td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.type}</td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.date || '-'}</td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.cycle}ë…„</td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.nextDate || '-'}</td>
                    <td style='padding:8px;border:1px solid #e0e0e0;'>${displayInst.calibType}</td>
                </tr>`;
            }
        });
        html += '</tbody></table>';
    }
    document.getElementById('instrument-list-table').innerHTML = html;
}
// ê³„ì¸¡ê¸° í•„ë“œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ì¶”ê°€
function updateInstrumentField(idx, field, value) {
    const year = document.getElementById('list-year').value;
    const list = instrumentsByYear[year] || [];
    if (list[idx]) {
        list[idx][field] = value;
        // ì°¨ê¸° êµì • ì˜ˆì •ì¼ ìë™ ê³„ì‚°
        if (field === 'date' || field === 'cycle') {
            const date = list[idx].date;
            const cycle = parseInt(list[idx].cycle);
            if (date && cycle) {
                const d = new Date(date);
                d.setFullYear(d.getFullYear() + cycle);
                list[idx].nextDate = d.toISOString().slice(0, 10);
            }
        }
    }
}
// ê³„ì¸¡ê¸° List ë³€ê²½ì‚¬í•­ ì €ì¥ í•¨ìˆ˜ ì¶”ê°€
function saveInstrumentListChanges() {
    alert('ê³„ì¸¡ê¸° ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
    
    // ìˆ˜ì • ëª¨ë“œ í•´ì œ
    isEditMode = false;
    const editBtn = document.getElementById('edit-mode-btn');
    const saveBtn = document.getElementById('save-btn');
    
    editBtn.textContent = 'ìˆ˜ì •';
    editBtn.style.background = 'linear-gradient(90deg, #3498db, #2980b9)';
    saveBtn.style.display = 'none';
    
    // ë‹¤ë¥¸ í˜ì´ì§€ë“¤ë„ ì—…ë°ì´íŠ¸
    renderInstrumentList();
    renderStatusList();
    renderHomeYearSummary();
    renderHistoryList();
}

// ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
function updateButtonStates() {
    const checkboxes = document.querySelectorAll('.instrument-checkbox:checked');
    const editBtn = document.getElementById('edit-mode-btn');
    const deleteBtn = document.getElementById('delete-btn');
    if (checkboxes.length > 0) {
        editBtn.disabled = false;
        deleteBtn.disabled = false;
    } else {
        editBtn.disabled = true;
        deleteBtn.disabled = true;
    }
    // ì²´í¬ë°•ìŠ¤ ìƒíƒœê°€ ë°”ë€” ë•Œë§ˆë‹¤ ë¦¬ìŠ¤íŠ¸ë¥¼ ë‹¤ì‹œ ë Œë”ë§
    if (isEditMode) {
        renderInstrumentList();
    }
}



// ì „ì²´ ì„ íƒ/í•´ì œ í•¨ìˆ˜
function toggleSelectAll(type, checked) {
    const checkboxes = document.querySelectorAll(`.instrument-checkbox[data-type="${type}"]`);
    checkboxes.forEach(checkbox => {
        checkbox.checked = checked;
    });
    updateButtonStates();
}

// ì„ íƒëœ ê³„ì¸¡ê¸° ì‚­ì œ í•¨ìˆ˜
function deleteSelectedInstruments() {
    const checkboxes = document.querySelectorAll('.instrument-checkbox:checked');
    if (checkboxes.length === 0) {
        alert('ì‚­ì œí•  ê³„ì¸¡ê¸°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }
    
    const year = document.getElementById('list-year').value;
    const confirmMessage = `ì„ íƒëœ ${checkboxes.length}ê°œì˜ ê³„ì¸¡ê¸°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
    if (!confirm(confirmMessage)) {
        return;
    }
    
    let deletedCount = 0;
    
    checkboxes.forEach(checkbox => {
        const instrumentId = checkbox.getAttribute('data-instrument-id');
        
        // ëª¨ë“  ì—°ë„ì—ì„œ í•´ë‹¹ ê³„ì¸¡ê¸° ì°¾ì•„ì„œ ì‚­ì œ
        Object.keys(instrumentsByYear).forEach(y => {
            const list = instrumentsByYear[y] || [];
            const index = list.findIndex(inst => inst.id === instrumentId);
            if (index !== -1) {
                list.splice(index, 1);
                deletedCount++;
            }
        });
    });
    
    alert(`${deletedCount}ê°œì˜ ê³„ì¸¡ê¸°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
    localStorage.setItem('instrumentsByYear', JSON.stringify(instrumentsByYear));
    renderInstrumentList();
    renderStatusList();
    renderHomeYearSummary();
    renderHistoryList();
}
// ì—°ë„ ëª©ë¡ ìƒì„± í•¨ìˆ˜ ì¶”ê°€
function generateYearOptions() {
    const currentYear = new Date().getFullYear();
    const years = [];
    for (let i = currentYear - 3; i <= currentYear + 3; i++) {
        years.push(i);
    }
    return years;
}

// ì—°ë„ ì˜µì…˜ ì´ˆê¸°í™” í•¨ìˆ˜
function initializeYearOptions() {
    const years = generateYearOptions();
    const currentYear = new Date().getFullYear();
    
    // ë“±ë¡ í¼ ì—°ë„ ì˜µì…˜ ì„¤ì •
    const regYearSelect = document.getElementById('reg-year');
    if (regYearSelect) {
        regYearSelect.innerHTML = years.map(y => 
            `<option value="${y}" ${y === currentYear ? 'selected' : ''}>${y}</option>`
        ).join('');
        // êµì •ë²ˆí˜¸ ì ‘ë‘ì‚¬ ì—…ë°ì´íŠ¸
        updateCalibrationNumber();
    }
    
    // ê²€êµì • í˜„í™© ì—°ë„ ì˜µì…˜ ì„¤ì •
    const statusYearSelect = document.getElementById('status-year');
    if (statusYearSelect) {
        statusYearSelect.innerHTML = years.map(y => 
            `<option value="${y}" ${y === currentYear ? 'selected' : ''}>${y}</option>`
        ).join('');
    }
    
    // ê³„ì¸¡ê¸° List ì—°ë„ ì˜µì…˜ ì„¤ì •
    const listYearSelect = document.getElementById('list-year');
    if (listYearSelect) {
        listYearSelect.innerHTML = years.map(y => 
            `<option value="${y}" ${y === currentYear ? 'selected' : ''}>${y}</option>`
        ).join('');
    }
}

// êµì •ë²ˆí˜¸ ì ‘ë‘ì‚¬ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
function updateCalibrationNumber() {
    const yearSelect = document.getElementById('reg-year');
    const yearPrefix = document.getElementById('reg-year-prefix');
    const calibType = document.getElementById('reg-calib-type');
    
    if (yearSelect && yearPrefix) {
        const selectedYear = yearSelect.value;
        yearPrefix.textContent = selectedYear;
        
        // ê²€êµì • êµ¬ë¶„ì— ë”°ë¼ ì ‘ë‘ì‚¬ í‘œì‹œ ì œì–´
        if (calibType && calibType.value === 'ì™¸ë¶€') {
            yearPrefix.style.display = 'none';
        } else {
            yearPrefix.style.display = 'inline';
        }
    }
}
// ì—°ë„ë³„ êµì •ë²ˆí˜¸ ìƒì„± í•¨ìˆ˜ ì¶”ê°€
function generateCalibrationNumber(originalNum, targetYear) {
    if (!originalNum) return '';
    // ì›ë˜ êµì •ë²ˆí˜¸ì—ì„œ ì—°ë„ ë¶€ë¶„ì„ ì¶”ì¶œí•˜ê³  ìƒˆë¡œìš´ ì—°ë„ë¡œ êµì²´
    const yearMatch = originalNum.match(/^\d{4}/);
    if (yearMatch) {
        return originalNum.replace(/^\d{4}/, targetYear);
    }
    // ì—°ë„ê°€ ì—†ëŠ” ê²½ìš° ì•ì— ì¶”ê°€
    return targetYear + '-' + originalNum;
}

// ê³„ì¸¡ê¸° ì •ë³´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ì—°ë„ë³„ í‘œì‹œìš©)
function getInstrumentDisplayInfo(inst, targetYear) {
    const currentYear = new Date().getFullYear();
    const registeredYear = parseInt(inst.year);
    
    // í˜„ì¬ ì—°ë„ ì´í›„ë¡œ ì„ íƒëœ ê²½ìš°
    if (targetYear > currentYear) {
        // í•´ë‹¹ ì—°ë„ì— ê²€êµì • ì¼ìê°€ ë“±ë¡ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
        if (inst.calibDate && inst.calibDate.trim() !== '') {
            // ê²€êµì • ì¼ìê°€ ìˆëŠ” ê²½ìš°: êµì •ì¼ì€ ê²€êµì • ì¼ìë¡œ ì—…ë°ì´íŠ¸, ì°¨ê¸° êµì • ì˜ˆì •ì¼ë„ ì—…ë°ì´íŠ¸
            const calibDate = new Date(inst.calibDate);
            
            // ì°¨ê¸° êµì • ì˜ˆì •ì¼ ê³„ì‚° (ê²€êµì • ì¼ì + êµì •ì£¼ê¸°)
            const nextCalibDate = new Date(calibDate);
            nextCalibDate.setFullYear(nextCalibDate.getFullYear() + inst.cycle);
            const newNextDate = nextCalibDate.toISOString().slice(0, 10);
            
            return {
                ...inst,
                date: inst.calibDate, // êµì •ì¼ì„ ê²€êµì • ì¼ìë¡œ ì—…ë°ì´íŠ¸
                nextDate: newNextDate, // ì°¨ê¸° êµì • ì˜ˆì •ì¼ ì—…ë°ì´íŠ¸
                unit: inst.unit // ë‹¨ìœ„ ì •ë³´ í¬í•¨
            };
        } else {
            // ê²€êµì • ì¼ìê°€ ì—†ìœ¼ë©´ ì›ë˜ ê°’ ìœ ì§€
            return {
                ...inst,
                date: inst.date, // ì›ë˜ êµì •ì¼ ìœ ì§€
                nextDate: inst.nextDate, // ì›ë˜ ì°¨ê¸° êµì • ì˜ˆì •ì¼ ìœ ì§€
                unit: inst.unit // ë‹¨ìœ„ ì •ë³´ í¬í•¨
            };
        }
    }
    
    // í˜„ì¬ ì—°ë„ ì´í•˜ì¸ ê²½ìš° ì›ë³¸ ì •ë³´ ê·¸ëŒ€ë¡œ ë°˜í™˜
    return {
        ...inst,
        unit: inst.unit // ë‹¨ìœ„ ì •ë³´ í¬í•¨
    };
}

// í™ˆí™”ë©´ ì „ì²´ ê³„íš ëŒ€ë¹„ ì‹¤ì  ê°€ë¡œ ë§‰ëŒ€ ê·¸ë˜í”„ ë Œë”ë§
function renderHomeOverallProgress() {
    const currentYear = new Date().getFullYear().toString();
    const statusData = statusDataByYear[currentYear] || [];
    
    // ì œëª©ì— ì—°ë„ ì¶”ê°€
    const titleElement = document.getElementById('overall-progress-title');
    if (titleElement) {
        titleElement.textContent = `${currentYear}ë…„ ì „ì²´ ê³„íš ëŒ€ë¹„ ì‹¤ì `;
    }
    
    // ì „ì²´ ê³„íšê³¼ ì‹¤ì  ê³„ì‚°
    const totalPlan = statusData.reduce((sum, item) => sum + item.plan, 0);
    const totalActual = statusData.reduce((sum, item) => sum + item.actual, 0);
    
    // ë‹¬ì„±ë¥  ê³„ì‚°
    const percentage = totalPlan > 0 ? Math.round((totalActual / totalPlan) * 100) : 0;
    
    // ê°€ë¡œ ë§‰ëŒ€ ê·¸ë˜í”„ ìƒì„±
    const progressBar = document.getElementById('home-overall-progress');
    const percentageText = document.getElementById('home-overall-percentage');
    
    if (progressBar && percentageText) {
        // ì§„í–‰ë¥ ì— ë”°ë¥¸ ìƒ‰ìƒ ê²°ì •
        let barColor = '#e74c3c'; // ë¹¨ê°„ìƒ‰ (ë‚®ì€ ë‹¬ì„±ë¥ )
        let textColor = '#e74c3c';
        if (percentage >= 80) {
            barColor = '#27ae60'; // ì´ˆë¡ìƒ‰ (ë†’ì€ ë‹¬ì„±ë¥ )
            textColor = '#27ae60';
        } else if (percentage >= 60) {
            barColor = '#f39c12'; // ì£¼í™©ìƒ‰ (ë³´í†µ ë‹¬ì„±ë¥ )
            textColor = '#f39c12';
        }
        
        progressBar.innerHTML = `
            <div style="
                width: 100%;
                height: 40px;
                background: #ecf0f1;
                border-radius: 20px;
                overflow: hidden;
                position: relative;
                box-shadow: inset 0 3px 6px rgba(0,0,0,0.1);
                border: 2px solid #d0d6e1;
            ">
                <div style="
                    width: ${Math.min(percentage, 100)}%;
                    height: 100%;
                    background: linear-gradient(90deg, ${barColor}, ${barColor}dd);
                    border-radius: 18px;
                    transition: width 1s ease-in-out;
                    position: relative;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                ">
                    <div style="
                        position: absolute;
                        right: 15px;
                        top: 50%;
                        transform: translateY(-50%);
                        color: white;
                        font-weight: bold;
                        font-size: 1em;
                        text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
                    ">${totalActual}/${totalPlan}</div>
                </div>
            </div>
        `;
        
        percentageText.innerHTML = `<span style="color:${textColor};">${percentage}% ë‹¬ì„±</span>`;
    }
}

// Excel íŒŒì¼ ì²˜ë¦¬ í•¨ìˆ˜ë“¤
let excelData = [];

function uploadExcelFile() {
    const fileInput = document.getElementById('excel-file');
    const file = fileInput.files[0];
    
    if (!file) {
        alert('Excel/CSV íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }
    
    // íŒŒì¼ ì²˜ë¦¬ í•¨ìˆ˜
    const processFile = (fileContent) => {
        try {
            console.log('íŒŒì¼ ì½ê¸° ì‹œì‘');
            let jsonData;
            
            // íŒŒì¼ í™•ì¥ìì— ë”°ë¼ ì²˜ë¦¬ ë°©ì‹ ê²°ì •
            if (file.name.toLowerCase().endsWith('.csv')) {
                // CSV íŒŒì¼ ì²˜ë¦¬
                const csvText = fileContent.toString();
                jsonData = parseCSV(csvText);
            } else {
                // Excel íŒŒì¼ ì²˜ë¦¬
                const data = new Uint8Array(fileContent);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];
                jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
            }
            
            if (jsonData.length < 2) {
                alert('Excel íŒŒì¼ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // í—¤ë” í™•ì¸
            const headers = jsonData[0];
            const requiredHeaders = ['ê³„ì¸¡ê¸°ëª…', 'Service', 'ìœ í˜•', 'ë“±ë¡ì—°ë„', 'êµì •ë²ˆí˜¸', 'êµì •ì¼', 'êµì •ì£¼ê¸°', 'ì°¨ê¸° êµì • ì˜ˆì •ì¼', 'í—ˆìš©ì˜¤ì°¨', 'ê²€êµì •êµ¬ë¶„', 'ì‚¬ìš©ê²€êµì •ê¸°'];
            
            const missingHeaders = requiredHeaders.filter(header => !headers.includes(header));
            if (missingHeaders.length > 0) {
                let errorMessage = `í•„ìˆ˜ ì»¬ëŸ¼ì´ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤:\n\n`;
                errorMessage += `âŒ ëˆ„ë½ëœ ì»¬ëŸ¼: ${missingHeaders.join(', ')}\n\n`;
                errorMessage += `âœ… í•„ìˆ˜ ì»¬ëŸ¼ (ì •í™•íˆ ì¼ì¹˜í•´ì•¼ í•¨):\n`;
                errorMessage += `${requiredHeaders.join(', ')}\n\n`;
                errorMessage += `ğŸ“‹ í˜„ì¬ íŒŒì¼ì˜ ì»¬ëŸ¼:\n`;
                errorMessage += `${headers.join(', ')}\n\n`;
                errorMessage += `ğŸ’¡ í•´ê²° ë°©ë²•:\n`;
                errorMessage += `1. ì»¬ëŸ¼ëª…ì„ ì •í™•íˆ ì¼ì¹˜ì‹œì¼œì£¼ì„¸ìš”\n`;
                errorMessage += `2. ê³µë°±ì´ë‚˜ íŠ¹ìˆ˜ë¬¸ìê°€ ì—†ëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”\n`;
                errorMessage += `3. UTF-8 ì¸ì½”ë”©ìœ¼ë¡œ ì €ì¥í•´ì£¼ì„¸ìš”`;
                
                alert(errorMessage);
                return;
            }
            
            // ë°ì´í„° ì²˜ë¦¬
            excelData = [];
            for (let i = 1; i < jsonData.length; i++) {
                const row = jsonData[i];
                if (row.length > 0 && row[0]) { // ì²« ë²ˆì§¸ ì»¬ëŸ¼ì´ ë¹„ì–´ìˆì§€ ì•Šì€ ê²½ìš°ë§Œ
                    const instrument = {
                        name: row[headers.indexOf('ê³„ì¸¡ê¸°ëª…')] || '',
                        service: row[headers.indexOf('Service')] || '',
                        type: row[headers.indexOf('ìœ í˜•')] || '',
                        year: row[headers.indexOf('ë“±ë¡ì—°ë„')] || new Date().getFullYear().toString(),
                        num: row[headers.indexOf('êµì •ë²ˆí˜¸')] || '',
                        date: row[headers.indexOf('êµì •ì¼')] || '',
                        cycle: parseInt(row[headers.indexOf('êµì •ì£¼ê¸°')]) || 1,
                        nextDate: row[headers.indexOf('ì°¨ê¸° êµì • ì˜ˆì •ì¼')] || '',
                        allowError: row[headers.indexOf('í—ˆìš©ì˜¤ì°¨')] || '',
                        calibType: row[headers.indexOf('ê²€êµì •êµ¬ë¶„')] || 'ìì²´',
                        calibEquipment: row[headers.indexOf('ì‚¬ìš©ê²€êµì •ê¸°')] || ''
                    };
                    
                    // ì°¨ê¸° êµì • ì˜ˆì •ì¼ì´ ì—†ìœ¼ë©´ ìë™ ê³„ì‚°
                    if (!instrument.nextDate && instrument.date) {
                        const calibDate = new Date(instrument.date);
                        calibDate.setFullYear(calibDate.getFullYear() + instrument.cycle);
                        instrument.nextDate = calibDate.toISOString().slice(0, 10);
                    }
                    
                    excelData.push(instrument);
                }
            }
            
            if (excelData.length === 0) {
                alert('ì²˜ë¦¬í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
            showExcelPreview();
            
        } catch (error) {
            console.error('íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
            
            let errorMessage = 'íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\n';
            errorMessage += 'ì˜¤ë¥˜ ìœ í˜•: ' + error.message + '\n\n';
            errorMessage += 'í•´ê²° ë°©ë²•:\n';
            errorMessage += '1. CSV íŒŒì¼ì¸ ê²½ìš°: UTF-8 ì¸ì½”ë”©ìœ¼ë¡œ ì €ì¥\n';
            errorMessage += '2. Excel íŒŒì¼ì¸ ê²½ìš°: Excel 97-2003 í˜•ì‹ìœ¼ë¡œ ì €ì¥\n';
            errorMessage += '3. íŒŒì¼ì´ ì†ìƒë˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸\n';
            errorMessage += '4. í•„ìˆ˜ ì»¬ëŸ¼ì´ ëª¨ë‘ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸\n\n';
            errorMessage += 'í•„ìˆ˜ ì»¬ëŸ¼: ê³„ì¸¡ê¸°ëª…, Service, ìœ í˜•, êµì •ë²ˆí˜¸, êµì •ì¼, êµì •ì£¼ê¸°, í—ˆìš©ì˜¤ì°¨, ê²€êµì •êµ¬ë¶„, ì‚¬ìš©ê²€êµì •ê¸°';
            
            alert(errorMessage);
        }
    };
    
    // CSV íŒŒì¼ì¸ ê²½ìš° í…ìŠ¤íŠ¸ë¡œ ì½ê¸°
    if (file.name.toLowerCase().endsWith('.csv')) {
        const reader = new FileReader();
        reader.onload = (e) => processFile(e.target.result);
        reader.onerror = (e) => {
            console.error('CSV íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', e);
            alert('CSV íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        };
        reader.readAsText(file, 'UTF-8');
    } else {
        // Excel íŒŒì¼ì¸ ê²½ìš° ArrayBufferë¡œ ì½ê¸°
        const reader = new FileReader();
        reader.onload = (e) => processFile(e.target.result);
        reader.onerror = (e) => {
            console.error('Excel íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', e);
            alert('Excel íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        };
        reader.readAsArrayBuffer(file);
    }
}

function showExcelPreview() {
    const previewDiv = document.getElementById('excel-data-preview');
    const previewSection = document.getElementById('excel-preview');
    
    let html = '<table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">';
    html += '<thead><tr style="background: #f0f4fa;">';
    html += '<th style="padding: 8px; border: 1px solid #ddd;">ê³„ì¸¡ê¸°ëª…</th>';
    html += '<th style="padding: 8px; border: 1px solid #ddd;">Service</th>';
    html += '<th style="padding: 8px; border: 1px solid #ddd;">ìœ í˜•</th>';
    html += '<th style="padding: 8px; border: 1px solid #ddd;">ë“±ë¡ì—°ë„</th>';
    html += '<th style="padding: 8px; border: 1px solid #ddd;">êµì •ë²ˆí˜¸</th>';
    html += '<th style="padding: 8px; border: 1px solid #ddd;">êµì •ì¼</th>';
    html += '<th style="padding: 8px; border: 1px solid #ddd;">êµì •ì£¼ê¸°</th>';
    html += '<th style="padding: 8px; border: 1px solid #ddd;">ì°¨ê¸° êµì • ì˜ˆì •ì¼</th>';
    html += '<th style="padding: 8px; border: 1px solid #ddd;">ê²€êµì •êµ¬ë¶„</th>';
    html += '</tr></thead><tbody>';
    
    excelData.forEach((item, index) => {
        html += `<tr style="border-bottom: 1px solid #eee;">`;
        html += `<td style="padding: 8px; border: 1px solid #ddd;">${item.name}</td>`;
        html += `<td style="padding: 8px; border: 1px solid #ddd;">${item.service}</td>`;
        html += `<td style="padding: 8px; border: 1px solid #ddd;">${item.type}</td>`;
        html += `<td style="padding: 8px; border: 1px solid #ddd;">${item.year}</td>`;
        html += `<td style="padding: 8px; border: 1px solid #ddd;">${item.num}</td>`;
        html += `<td style="padding: 8px; border: 1px solid #ddd;">${item.date}</td>`;
        html += `<td style="padding: 8px; border: 1px solid #ddd;">${item.cycle}ë…„</td>`;
        html += `<td style="padding: 8px; border: 1px solid #ddd;">${item.nextDate}</td>`;
        html += `<td style="padding: 8px; border: 1px solid #ddd;">${item.calibType}</td>`;
        html += `</tr>`;
    });
    
    html += '</tbody></table>';
    html += `<p style="margin-top: 10px; color: #666;">ì´ ${excelData.length}ê°œì˜ ê³„ì¸¡ê¸°ê°€ ë“±ë¡ë©ë‹ˆë‹¤.</p>`;
    
    previewDiv.innerHTML = html;
    previewSection.style.display = 'block';
}

function confirmExcelUpload() {
    console.log('=== Excel ì¼ê´„ë“±ë¡ ì‹œì‘ ===');
    console.log('excelData:', excelData);
    
    if (excelData.length === 0) {
        alert('ë“±ë¡í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    
    // ì‚¬ìš©ìì—ê²Œ ê¸°ì¡´ ë°ì´í„° ì²˜ë¦¬ ë°©ë²• ì„ íƒ
    const choice = confirm('Excel ë°ì´í„°ë¡œ ê¸°ì¡´ ë°ì´í„°ë¥¼ êµì²´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n' +
                          'í™•ì¸: ê¸°ì¡´ ë°ì´í„°ë¥¼ ëª¨ë‘ ì‚­ì œí•˜ê³  Excel ë°ì´í„°ë¡œ êµì²´\n' +
                          'ì·¨ì†Œ: ì¤‘ë³µ ì²´í¬ í›„ ìƒˆ ë°ì´í„°ë§Œ ì¶”ê°€');
    
    console.log('ì‚¬ìš©ì ì„ íƒ:', choice);
    
    if (choice) {
        // ê¸°ì¡´ ë°ì´í„° ì™„ì „ ì´ˆê¸°í™”
        console.log('ê¸°ì¡´ ë°ì´í„° ì´ˆê¸°í™” ì„ íƒë¨');
        instrumentsByYear = {};
        // localStorageë„ ì´ˆê¸°í™”
        localStorage.removeItem('instrumentsByYear');
        console.log('instrumentsByYear ë° localStorage ì´ˆê¸°í™” ì™„ë£Œ');
    } else {
        console.log('ì¤‘ë³µ ì²´í¬ ëª¨ë“œ ì„ íƒë¨');
    }
    
    const currentYear = new Date().getFullYear().toString();
    console.log('í˜„ì¬ ì—°ë„:', currentYear);
    console.log('í˜„ì¬ instrumentsByYear:', instrumentsByYear);
    
    // ë°ì´í„° êµ¬ì¡° í™•ì¸
    if (!instrumentsByYear) {
        instrumentsByYear = {};
        console.log('instrumentsByYear ì´ˆê¸°í™”');
    }
    
    let successCount = 0;
    let duplicateCount = 0;
    
    if (choice) {
        // ë°ì´í„° êµì²´ ëª¨ë“œ: ëª¨ë“  Excel ë°ì´í„°ë¥¼ ê¸°ì¡´ ë°ì´í„°ë¡œ êµì²´
        console.log('=== ë°ì´í„° êµì²´ ëª¨ë“œ ===');
        
        excelData.forEach((item, index) => {
            console.log(`ì²˜ë¦¬ ì¤‘: ${index + 1}/${excelData.length} - ${item.name} (${item.num})`);
            
            // ê³ ìœ  ID ìƒì„±
            const timestamp = Date.now();
            const random = Math.random().toString(36).substr(2, 9);
            item.id = `${timestamp}-${random}`;
            
            // í•´ë‹¹ ì—°ë„ ë°°ì—´ì´ ì—†ìœ¼ë©´ ìƒì„±
            if (!instrumentsByYear[item.year]) {
                instrumentsByYear[item.year] = [];
                console.log(`${item.year}ë…„ ë°°ì—´ ìƒì„±`);
            }
            
            // ë°ì´í„° ì¶”ê°€
            instrumentsByYear[item.year].push(item);
            successCount++;
            console.log(`âœ… ë“±ë¡: ${item.name} (${item.num})`);
        });
        
    } else {
        // ì¤‘ë³µ ì²´í¬ ëª¨ë“œ: ì¤‘ë³µ í™•ì¸ í›„ ìƒˆ ë°ì´í„°ë§Œ ì¶”ê°€
        console.log('=== ì¤‘ë³µ ì²´í¬ ëª¨ë“œ ===');
        
        excelData.forEach((item, index) => {
            console.log(`ì²˜ë¦¬ ì¤‘: ${index + 1}/${excelData.length} - ${item.name} (${item.num})`);
            
            let shouldAdd = true;
            
            // ì¤‘ë³µ í™•ì¸
            Object.keys(instrumentsByYear).forEach(year => {
                const list = instrumentsByYear[year] || [];
                const nameDuplicate = list.some(inst => inst.name === item.name);
                const numDuplicate = list.some(inst => inst.num === item.num);
                
                if (nameDuplicate || numDuplicate) {
                    shouldAdd = false;
                    duplicateCount++;
                    console.log(`âŒ ì¤‘ë³µ ì œì™¸: ${item.name} (${item.num})`);
                }
            });
            
            if (shouldAdd) {
                // ê³ ìœ  ID ìƒì„±
                const timestamp = Date.now();
                const random = Math.random().toString(36).substr(2, 9);
                item.id = `${timestamp}-${random}`;
                
                // í•´ë‹¹ ì—°ë„ ë°°ì—´ì´ ì—†ìœ¼ë©´ ìƒì„±
                if (!instrumentsByYear[item.year]) {
                    instrumentsByYear[item.year] = [];
                    console.log(`${item.year}ë…„ ë°°ì—´ ìƒì„±`);
                }
                
                // ë°ì´í„° ì¶”ê°€
                instrumentsByYear[item.year].push(item);
                successCount++;
                console.log(`âœ… ë“±ë¡: ${item.name} (${item.num})`);
            }
        });
    }
    
    console.log(`\n=== ìµœì¢… ê²°ê³¼ ===`);
    console.log(`ì´ Excel ë°ì´í„°: ${excelData.length}ê°œ`);
    console.log(`ì„±ê³µ ë“±ë¡: ${successCount}ê°œ`);
    console.log(`ì¤‘ë³µ ì œì™¸: ${duplicateCount}ê°œ`);
    console.log(`ìµœì¢… instrumentsByYear:`, instrumentsByYear);
    
    console.log('\n=== ë“±ë¡ ê²°ê³¼ ===');
    console.log('ìµœì¢… instrumentsByYear:', instrumentsByYear);
    
    // ê²°ê³¼ ë©”ì‹œì§€
    let message = `ì¼ê´„ ë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n\n`;
    message += `âœ… ì„±ê³µ: ${successCount}ê°œ\n`;
    if (duplicateCount > 0) {
        message += `âš ï¸ ì¤‘ë³µ ì œì™¸: ${duplicateCount}ê°œ\n`;
    }
    message += `\nğŸ“‹ ë“±ë¡ëœ ê³„ì¸¡ê¸°ëŠ” 'ê³„ì¸¡ê¸° List'ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
    
    alert(message);
    
    // UI ì´ˆê¸°í™”
    document.getElementById('excel-file').value = '';
    document.getElementById('excel-preview').style.display = 'none';
    excelData = [];
    
    // ë°ì´í„°ë¥¼ localStorageì— ì €ì¥
    localStorage.setItem('instrumentsByYear', JSON.stringify(instrumentsByYear));
    console.log('localStorageì— ì €ì¥ ì™„ë£Œ');
    
    // ì €ì¥ëœ ë°ì´í„° í™•ì¸
    const savedData = localStorage.getItem('instrumentsByYear');
    console.log('ì €ì¥ëœ ë°ì´í„° í™•ì¸:', savedData);
    
    // ëª¨ë“  í™”ë©´ ì—…ë°ì´íŠ¸
    try {
        console.log('í™”ë©´ ì—…ë°ì´íŠ¸ ì‹œì‘...');
        
        renderHomeChart();
        console.log('âœ… í™ˆ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        
        renderHomeYearSummary();
        console.log('âœ… í™ˆ ì—°ë„ ìš”ì•½ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        
        renderInstrumentList();
        console.log('âœ… ê³„ì¸¡ê¸° ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        
        renderStatusList();
        console.log('âœ… ìƒíƒœ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        
        renderHistoryList();
        console.log('âœ… ì´ë ¥ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        
        console.log('ëª¨ë“  í™”ë©´ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
    } catch (error) {
        console.error('âŒ í™”ë©´ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜:', error);
    }
    
    // ì¼ê´„ë“±ë¡ í›„ ê³„ì¸¡ê¸° List í˜ì´ì§€ë¡œ ìë™ ì´ë™
    console.log('ê³„ì¸¡ê¸° List í˜ì´ì§€ë¡œ ì´ë™...');
    showPage('list');
}

// CSV íŒŒì‹± í•¨ìˆ˜
function parseCSV(csvText) {
    try {
        // ì¤„ë°”ê¿ˆ ë¬¸ì ì •ê·œí™” (Windows, Mac, Unix ëª¨ë‘ ì§€ì›)
        const normalizedText = csvText.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
        const lines = normalizedText.split('\n');
        const result = [];
        
        for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            if (line) {
                // ì‰¼í‘œë¡œ ë¶„ë¦¬í•˜ë˜, ë”°ì˜´í‘œ ì•ˆì˜ ì‰¼í‘œëŠ” ë¬´ì‹œ
                const values = [];
                let current = '';
                let inQuotes = false;
                
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        values.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                values.push(current.trim());
                result.push(values);
            }
        }
        
        return result;
    } catch (error) {
        console.error('CSV íŒŒì‹± ì˜¤ë¥˜:', error);
        throw new Error('CSV íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
    }
}

// Excel.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€
function loadExcelLibrary() {
    if (typeof XLSX === 'undefined') {
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js';
        script.onload = function() {
            console.log('Excel.js ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
        };
        document.head.appendChild(script);
    }
}

// Excel ë¯¸ë¦¬ë³´ê¸° ì´ˆê¸°í™” í•¨ìˆ˜
function resetExcelPreview() {
    excelData = [];
    document.getElementById('excel-preview').style.display = 'none';
    document.getElementById('excel-data-preview').innerHTML = '';
}

// ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
function testSystem() {
    console.log('=== ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
    
    // ë°ì´í„° ìƒíƒœ í™•ì¸
    console.log('instrumentsByYear:', instrumentsByYear);
    console.log('localStorage ë°ì´í„°:', localStorage.getItem('instrumentsByYear'));
    
    // í•¨ìˆ˜ ì¡´ì¬ í™•ì¸
    console.log('showPage í•¨ìˆ˜:', typeof showPage);
    console.log('renderHomeChart í•¨ìˆ˜:', typeof renderHomeChart);
    console.log('renderInstrumentList í•¨ìˆ˜:', typeof renderInstrumentList);
    
    // DOM ìš”ì†Œ í™•ì¸
    const elements = ['page-home', 'page-register', 'page-list', 'page-status', 'page-history'];
    elements.forEach(id => {
        const element = document.getElementById(id);
        console.log(`${id} ìš”ì†Œ:`, element ? 'ì¡´ì¬' : 'ì—†ìŒ');
    });
    
    // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€
    if (!instrumentsByYear['2025']) {
        instrumentsByYear['2025'] = [];
    }
    
    const testInstrument = {
        id: Date.now(),
        name: 'í…ŒìŠ¤íŠ¸ ê³„ì¸¡ê¸°',
        service: 'TEST',
        type: 'í…ŒìŠ¤íŠ¸',
        num: '2025-TEST-001',
        date: '2025-01-01',
        cycle: 1,
        nextDate: '2026-01-01',
        allowError: '0.1',
        calibType: 'ìì²´',
        calibEquipment: 'í…ŒìŠ¤íŠ¸ê¸°',
        year: '2025'
    };
    
    instrumentsByYear['2025'].push(testInstrument);
    localStorage.setItem('instrumentsByYear', JSON.stringify(instrumentsByYear));
    
    // í™”ë©´ ì—…ë°ì´íŠ¸
    renderHomeChart();
    renderHomeYearSummary();
    renderInstrumentList();
    
    alert('ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ! ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
}

// ë°ì´í„° ë””ë²„ê·¸ í•¨ìˆ˜
function debugData() {
    console.log('=== ë°ì´í„° ë””ë²„ê·¸ ì‹œì‘ ===');
    
    // í˜„ì¬ ë©”ëª¨ë¦¬ ë°ì´í„°
    console.log('ë©”ëª¨ë¦¬ instrumentsByYear:', instrumentsByYear);
    
    // localStorage ë°ì´í„°
    const savedData = localStorage.getItem('instrumentsByYear');
    console.log('localStorage ì›ë³¸ ë°ì´í„°:', savedData);
    
    if (savedData) {
        try {
            const parsedData = JSON.parse(savedData);
            console.log('localStorage íŒŒì‹±ëœ ë°ì´í„°:', parsedData);
            
            // ë°ì´í„° ë¹„êµ
            console.log('ë©”ëª¨ë¦¬ì™€ localStorage ë°ì´í„° ë¹„êµ:');
            Object.keys(parsedData).forEach(year => {
                const memoryData = instrumentsByYear[year] || [];
                const storageData = parsedData[year] || [];
                console.log(`${year}ë…„ - ë©”ëª¨ë¦¬: ${memoryData.length}ê°œ, ì €ì¥ì†Œ: ${storageData.length}ê°œ`);
                
                if (memoryData.length !== storageData.length) {
                    console.log(`âš ï¸ ${year}ë…„ ë°ì´í„° ë¶ˆì¼ì¹˜!`);
                    console.log('ë©”ëª¨ë¦¬ ë°ì´í„°:', memoryData);
                    console.log('ì €ì¥ì†Œ ë°ì´í„°:', storageData);
                }
            });
        } catch (error) {
            console.error('localStorage íŒŒì‹± ì˜¤ë¥˜:', error);
        }
    }
    
    // ë°ì´í„° ê°•ì œ ë™ê¸°í™”
    if (savedData) {
        try {
            const parsedData = JSON.parse(savedData);
            instrumentsByYear = parsedData;
            console.log('âœ… ë°ì´í„° ê°•ì œ ë™ê¸°í™” ì™„ë£Œ');
            
            // í™”ë©´ ì—…ë°ì´íŠ¸
            renderInstrumentList();
            renderHomeYearSummary();
            
            alert('ë°ì´í„° ë””ë²„ê·¸ ì™„ë£Œ! ë°ì´í„°ê°€ ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
        } catch (error) {
            console.error('ë°ì´í„° ë™ê¸°í™” ì˜¤ë¥˜:', error);
            alert('ë°ì´í„° ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    } else {
        alert('localStorageì— ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
    }
}



window.selectHistoryInstrument = selectHistoryInstrument;
window.addHistoryEntry = addHistoryEntry;

function addHistoryEntry(idx) {
    const inst = window._allInstrumentsForHistory[idx];
    const year = prompt('ì—°ë„ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 2025)');
    if (!year) return;
    const desc = prompt('ì´ë ¥ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”');
    if (!desc) return;
    inst.history.push({ year, desc });
    renderHistoryList();
}

function generatePdfWithHtml2Pdf(num){
    console.log('generatePdfWithHtml2Pdf í•¨ìˆ˜ í˜¸ì¶œë¨, num:', num);
    console.log('html2pdf ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸:', typeof html2pdf);
    
    // html2pdf ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ ë°©ë²• ì‚¬ìš©
    if (typeof html2pdf === 'undefined') {
        console.log('html2pdf ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì—†ìŒ, ê¸°ì¡´ generatePdf í•¨ìˆ˜ ì‚¬ìš©');
        generatePdf(num);
        return;
    }
    
    const year = document.getElementById('status-year').value;
    
    // ëª¨ë“  ì—°ë„ì˜ ê³„ì¸¡ê¸°ë¥¼ í•©ì³ì„œ í•´ë‹¹ ê³„ì¸¡ê¸° ì°¾ê¸°
    let allInstruments = [];
    Object.values(instrumentsByYear).forEach(yearArr => {
        allInstruments = allInstruments.concat(yearArr);
    });
    
    const inst = allInstruments.find(inst => inst.num === num);
    
    if (!inst) {
        alert('ê³„ì¸¡ê¸°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë²ˆí˜¸: ' + num);
        return;
    }
    
    // í˜„ì¬ ì—°ë„ì˜ ê²€êµì • ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    const yearData = inst.yearData && inst.yearData[year];
    const calibDate = yearData ? yearData.calibDate : '';
    const maxError = yearData ? yearData.maxError : '';
    const result = yearData ? yearData.result : '';
    
    // HTML ìƒì„±
    const htmlContent = `
        <div style="font-family: Arial, sans-serif; padding: 20px; max-width: 800px;">
            <div style="text-align: center; margin-bottom: 30px;">
                <h1 style="color: #2c3e50; margin: 0;">Instrument Calibration Certificate</h1>
            </div>
            
            <div style="margin-bottom: 20px;">
                <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold; width: 150px;">Instrument Name</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${inst.name}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">Service</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${inst.service}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">Type</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${inst.type}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">Calibration No</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${inst.num}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">Calibration Date</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${inst.date}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">Cycle</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${inst.cycle} years</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">Next Calibration</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${inst.nextDate}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">Allowable Error</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">Â±${inst.allowError}${inst.unit ? ' ' + inst.unit : ''}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">Calibration Date</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${calibDate || '-'}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">Max Error</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${maxError || '-'}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">Result</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${result || '-'}</td>
                    </tr>
                </table>
            </div>
            
            <div style="margin-top: 30px; display: flex; justify-content: space-between;">
                <div style="text-align: center;">
                    <div style="border-bottom: 1px solid #000; width: 100px; margin-bottom: 5px;"></div>
                    <span>Manager</span>
                </div>
                <div style="text-align: center;">
                    <div style="border-bottom: 1px solid #000; width: 100px; margin-bottom: 5px;"></div>
                    <span>Checker</span>
                </div>
            </div>
            
            <div style="margin-top: 20px; text-align: center; font-size: 12px; color: #666;">
                This certificate proves the calibration result of the instrument.
            </div>
        </div>
    `;
    
    console.log('HTML ë‚´ìš©:', htmlContent);
    
    // ì„ì‹œ div ìƒì„±
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = htmlContent;
    tempDiv.style.position = 'absolute';
    tempDiv.style.left = '-9999px';
    tempDiv.style.backgroundColor = 'white';
    tempDiv.style.width = '800px';
    document.body.appendChild(tempDiv);
    
    console.log('ì„ì‹œ div ìƒì„±ë¨:', tempDiv);
    
    // PDF ìƒì„± ì˜µì…˜ ë‹¨ìˆœí™”
    const opt = {
        margin: [10, 10, 10, 10],
        filename: `${inst.name}_Certificate.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { 
            scale: 1,
            useCORS: false,
            allowTaint: false,
            backgroundColor: '#ffffff'
        },
        jsPDF: { 
            unit: 'mm', 
            format: 'a4', 
            orientation: 'portrait',
            compress: true
        }
    };
    
    console.log('PDF ì˜µì…˜:', opt);
    
    // PDF ìƒì„± - ë” ê°„ë‹¨í•œ ë°©ë²• ì‚¬ìš©
    try {
        html2pdf()
            .from(tempDiv)
            .set(opt)
            .save()
            .then(() => {
                console.log('PDF ìƒì„± ì™„ë£Œ (html2pdf)');
                document.body.removeChild(tempDiv);
            })
            .catch(error => {
                console.error('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ (html2pdf):', error);
                document.body.removeChild(tempDiv);
                // ì˜¤ë¥˜ ë°œìƒ ì‹œ ê¸°ì¡´ ë°©ë²•ìœ¼ë¡œ ëŒ€ì²´
                console.log('ê¸°ì¡´ generatePdf í•¨ìˆ˜ë¡œ ëŒ€ì²´');
                generatePdf(num);
            });
    } catch (error) {
        console.error('html2pdf ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
        document.body.removeChild(tempDiv);
        // ì˜¤ë¥˜ ë°œìƒ ì‹œ ê¸°ì¡´ ë°©ë²•ìœ¼ë¡œ ëŒ€ì²´
        console.log('ê¸°ì¡´ generatePdf í•¨ìˆ˜ë¡œ ëŒ€ì²´');
        generatePdf(num);
    }
}

function generatePdfSimple(num){
    console.log('generatePdfSimple í•¨ìˆ˜ í˜¸ì¶œë¨, num:', num);
    
    const year = document.getElementById('status-year').value;
    
    // ëª¨ë“  ì—°ë„ì˜ ê³„ì¸¡ê¸°ë¥¼ í•©ì³ì„œ í•´ë‹¹ ê³„ì¸¡ê¸° ì°¾ê¸°
    let allInstruments = [];
    Object.values(instrumentsByYear).forEach(yearArr => {
        allInstruments = allInstruments.concat(yearArr);
    });
    
    const inst = allInstruments.find(inst => inst.num === num);
    
    if (!inst) {
        alert('ê³„ì¸¡ê¸°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë²ˆí˜¸: ' + num);
        return;
    }
    
    if (!window.jspdf || !window.jspdf.jsPDF) {
        alert('PDF ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.');
        return;
    }
    
    try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // ê¸°ë³¸ í°íŠ¸ ì‚¬ìš©
        doc.setFont('helvetica', 'normal');
        
        // ì œëª©
        doc.setFontSize(20);
        doc.text('Instrument Calibration Certificate', 105, 30, {align:'center'});
        
        // êµ¬ë¶„ì„ 
        doc.setDrawColor(200, 200, 200);
        doc.line(20, 40, 190, 40);
        
        // ì •ë³´ í…Œì´ë¸”
        doc.setFontSize(12);
        let y = 60;
        
        // ì™¼ìª½ ì—´ (ë¼ë²¨)
        doc.setFont('helvetica', 'bold');
        doc.text('Instrument Name:', 20, y);
        doc.text('Service:', 20, y + 12);
        doc.text('Type:', 20, y + 24);
        doc.text('Calibration No:', 20, y + 36);
        doc.text('Calibration Date:', 20, y + 48);
        doc.text('Cycle:', 20, y + 60);
        doc.text('Next Calibration:', 20, y + 72);
        doc.text('Allowable Error:', 20, y + 84);
        
        // í˜„ì¬ ì—°ë„ì˜ ê²€êµì • ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        const yearData = inst.yearData && inst.yearData[year];
        const calibDate = yearData ? yearData.calibDate : '';
        const maxError = yearData ? yearData.maxError : '';
        const result = yearData ? yearData.result : '';
        
        doc.text('Calibration Date:', 20, y + 96);
        doc.text('Max Error:', 20, y + 108);
        doc.text('Result:', 20, y + 120);
        
        // ì˜¤ë¥¸ìª½ ì—´ (ê°’)
        doc.setFont('helvetica', 'normal');
        doc.text(inst.name, 80, y);
        doc.text(inst.service, 80, y + 12);
        doc.text(inst.type, 80, y + 24);
        doc.text(inst.num, 80, y + 36);
        doc.text(inst.date, 80, y + 48);
        doc.text(inst.cycle + ' years', 80, y + 60);
        doc.text(inst.nextDate, 80, y + 72);
        doc.text('Â±' + inst.allowError + (inst.unit ? ' ' + inst.unit : ''), 80, y + 84);
        doc.text(calibDate || '-', 80, y + 96);
        doc.text(maxError || '-', 80, y + 108);
        doc.text(result || '-', 80, y + 120);
        
        // êµ¬ë¶„ì„ 
        doc.setDrawColor(200, 200, 200);
        doc.line(20, 150, 190, 150);
        
        // ì„œëª…ë€
        doc.setFontSize(12);
        doc.setFont('helvetica', 'bold');
        doc.text('Manager:', 30, 170);
        doc.text('Checker:', 120, 170);
        
        // ì„œëª… ë°•ìŠ¤
        doc.setDrawColor(100, 100, 100);
        doc.rect(30, 175, 60, 20);
        doc.rect(120, 175, 60, 20);
        
        // í•˜ë‹¨ ë©”ì‹œì§€
        doc.setFontSize(10);
        doc.setFont('helvetica', 'normal');
        doc.text('This certificate proves the calibration result of the instrument.', 105, 220, {align:'center'});
        
        // íŒŒì¼ ì €ì¥
        doc.save(`${inst.name}_Certificate.pdf`);
        console.log('PDF ìƒì„± ì™„ë£Œ (Simple)');
        
    } catch (error) {
        console.error('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜:', error);
        alert('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
    }
}

function generatePdfKorean(num){
    console.log('generatePdfKorean í•¨ìˆ˜ í˜¸ì¶œë¨, num:', num);
    
    const year = document.getElementById('status-year').value;
    
    // ëª¨ë“  ì—°ë„ì˜ ê³„ì¸¡ê¸°ë¥¼ í•©ì³ì„œ í•´ë‹¹ ê³„ì¸¡ê¸° ì°¾ê¸°
    let allInstruments = [];
    Object.values(instrumentsByYear).forEach(yearArr => {
        allInstruments = allInstruments.concat(yearArr);
    });
    
    const inst = allInstruments.find(inst => inst.num === num);
    
    if (!inst) {
        alert('ê³„ì¸¡ê¸°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë²ˆí˜¸: ' + num);
        return;
    }
    
    // í˜„ì¬ ì—°ë„ì˜ ê²€êµì • ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    const yearData = inst.yearData && inst.yearData[year];
    const calibDate = yearData ? yearData.calibDate : '';
    const maxError = yearData ? yearData.maxError : '';
    const result = yearData ? yearData.result : '';
    
    // jsPDF ì‚¬ìš©í•˜ì—¬ í•œê¸€ PDF ìƒì„±
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    // ê¸°ë³¸ í°íŠ¸ ì‚¬ìš© (í•œê¸€ í°íŠ¸ ë¡œë“œ ë¬¸ì œë¡œ ì¸í•´)
    doc.setFont('helvetica');
    console.log('ê¸°ë³¸ í°íŠ¸ ì‚¬ìš© (helvetica)');
    
    // í°íŠ¸ í¬ê¸° ì„¤ì •
    doc.setFontSize(12);
    
    // ì œëª©
    doc.setFontSize(20);
    doc.setFont('helvetica', 'bold');
    doc.text('ê³„ì¸¡ê¸° ê²€êµì • ì„±ì ì„œ', 105, 30, { align: 'center' });
    
    // í…Œì´ë¸” ë°ì´í„° (í•œê¸€ ë¼ë²¨, í•œê¸€ ë°ì´í„°)
    const tableData = [
        ['ê³„ì¸¡ê¸°ëª…', inst.name],
        ['Service', inst.service],
        ['ê³„ì¸¡ê¸° ìœ í˜•', inst.type],
        ['êµì •ë²ˆí˜¸', inst.num],
        ['êµì •ì¼', inst.date],
        ['êµì •ì£¼ê¸°', inst.cycle + 'ë…„'],
        ['ì°¨ê¸° êµì • ì˜ˆì •ì¼', inst.nextDate],
        ['í—ˆìš©ì˜¤ì°¨', 'Â±' + inst.allowError + (inst.unit ? ' ' + inst.unit : '')],
        ['ê²€êµì •ì¼', calibDate || '-'],
        ['ìµœëŒ€ì˜¤ì°¨', maxError || '-'],
        ['ê²€êµì • ê²°ê³¼', result || '-']
    ];
    
    // í…Œì´ë¸” ê·¸ë¦¬ê¸°
    let y = 50;
    doc.setFontSize(12);
    doc.setFont('helvetica', 'normal');
    
    tableData.forEach((row, index) => {
        // ë°°ê²½ìƒ‰ (ì§ìˆ˜ í–‰)
        if (index % 2 === 0) {
            doc.setFillColor(248, 249, 250);
            doc.rect(20, y - 5, 170, 10, 'F');
        }
        
        // ë¼ë²¨ (êµµê²Œ)
        doc.setFont('helvetica', 'bold');
        doc.text(row[0], 25, y);
        
        // ê°’
        doc.setFont('helvetica', 'normal');
        doc.text(row[1], 80, y);
        
        y += 12;
    });
    
    // ê¸°ì¤€ê°’/ì¸¡ì •ê°’ í‘œ ì¶”ê°€ (ìì²´ ê²€êµì •ì¸ ê²½ìš°ë§Œ)
    console.log('PDF ìƒì„± - calibType:', inst.calibType, 'yearData:', yearData);
    
    // ì„ì‹œ ë°ì´í„°ë„ í™•ì¸
    const temp = window._tempStatusEdits && window._tempStatusEdits[year] && window._tempStatusEdits[year][inst.num];
    console.log('ì„ì‹œ ë°ì´í„°:', temp);
    
    if ((inst.calibType === 'ìì²´' || inst.calibType === 'ìì²´ ê²€êµì •') && (yearData || temp)) {
        console.log('í‘œ ì¶”ê°€ ì‹œì‘');
        y += 10; // ìœ„ë¡œ ì˜¬ë¦¼ (20ì—ì„œ 10ìœ¼ë¡œ ë³€ê²½)
        doc.setFontSize(12);
        doc.setFont('helvetica', 'bold');
        
        // í‘œ ì œëª©
        doc.setFont('helvetica', 'bold');
        doc.text('ê¸°ì¤€ê°’/ì¸¡ì •ê°’', 105, y, {align: 'center'});
        y += 10;
        
        // ë‹¨ìœ„ ì¶”ì¶œ - ë” ì •í™•í•œ ë°©ë²•ìœ¼ë¡œ ê°œì„ 
        let unit = '';
        if (inst.unit) {
            unit = inst.unit;
        } else if (inst.allowError) {
            unit = extractUnitFromAllowError(inst.allowError);
        }
        console.log('ì¶”ì¶œëœ ë‹¨ìœ„:', unit, 'inst.unit:', inst.unit, 'inst.allowError:', inst.allowError);
        
        // í‘œ ê·¸ë¦¬ê¸°
        const tableX = 30;
        const tableY = y;
        const colWidth = 75;
        const rowHeight = 8;
        
        // í‘œ í…Œë‘ë¦¬
        doc.setDrawColor(100, 100, 100);
        doc.rect(tableX, tableY, colWidth * 2, rowHeight * 4);
        
        // í—¤ë”
        doc.setFont('helvetica', 'bold');
        doc.text('ê¸°ì¤€ê°’', tableX + colWidth/2, tableY + 5, {align: 'center'});
        doc.text('ì¸¡ì •ê°’', tableX + colWidth + colWidth/2, tableY + 5, {align: 'center'});
        
        // ì„¸ë¡œ êµ¬ë¶„ì„ 
        doc.line(tableX + colWidth, tableY, tableX + colWidth, tableY + rowHeight * 4);
        
        // ê°€ë¡œ êµ¬ë¶„ì„ ë“¤
        for (let i = 1; i <= 3; i++) {
            doc.line(tableX, tableY + rowHeight * i, tableX + colWidth * 2, tableY + rowHeight * i);
        }
        
        // ë°ì´í„° ì…ë ¥
        doc.setFont('helvetica', 'normal');
        doc.setFontSize(10);
        
        const std1 = (yearData && yearData.std1) || (temp && temp.std1) || '';
        const meas1 = (yearData && yearData.meas1) || (temp && temp.meas1) || '';
        const std2 = (yearData && yearData.std2) || (temp && temp.std2) || '';
        const meas2 = (yearData && yearData.meas2) || (temp && temp.meas2) || '';
        const std3 = (yearData && yearData.std3) || (temp && temp.std3) || '';
        const meas3 = (yearData && yearData.meas3) || (temp && temp.meas3) || '';
        
            // ë‹¨ìœ„ í‘œì‹œ í•¨ìˆ˜ (íŠ¹ìˆ˜ë¬¸ì ì²˜ë¦¬)
    const formatWithUnit = (value, unit) => {
        if (!value) return '';
        if (!unit) return value;
        
        // íŠ¹ìˆ˜ë¬¸ìë¥¼ ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
        let displayUnit = unit;
        if (unit === 'â„ƒ') {
            displayUnit = 'Â°C';  // ë” ì¼ë°˜ì ì¸ í‘œê¸°ë²• ì‚¬ìš©
        }
        
        return `${value} ${displayUnit}`;
    };
        
        // ì²« ë²ˆì§¸ í–‰
        doc.text(formatWithUnit(std1, unit), tableX + colWidth/2, tableY + rowHeight + 5, {align: 'center'});
        doc.text(formatWithUnit(meas1, unit), tableX + colWidth + colWidth/2, tableY + rowHeight + 5, {align: 'center'});
        
        // ë‘ ë²ˆì§¸ í–‰
        doc.text(formatWithUnit(std2, unit), tableX + colWidth/2, tableY + rowHeight * 2 + 5, {align: 'center'});
        doc.text(formatWithUnit(meas2, unit), tableX + colWidth + colWidth/2, tableY + rowHeight * 2 + 5, {align: 'center'});
        
        // ì„¸ ë²ˆì§¸ í–‰
        doc.text(formatWithUnit(std3, unit), tableX + colWidth/2, tableY + rowHeight * 3 + 5, {align: 'center'});
        doc.text(formatWithUnit(meas3, unit), tableX + colWidth + colWidth/2, tableY + rowHeight * 3 + 5, {align: 'center'});
        
        y += rowHeight * 4 + 20; // ê°„ê²© ëŠ˜ë¦¼ (10ì—ì„œ 20ìœ¼ë¡œ ë³€ê²½)
    }
    
    // ì„œëª…ë€ (í•˜ë‚˜ë¡œ ë³€ê²½)
    doc.setFontSize(14);
    doc.setFont('helvetica', 'bold');
    // ê°€ìš´ë° ì •ë ¬ë¡œ ê³„ì¸¡ê¸° ë‹´ë‹¹ íŒŒíŠ¸ì¥ ë°°ì¹˜
    doc.text('ê³„ì¸¡ê¸° ë‹´ë‹¹ íŒŒíŠ¸ì¥(ì¸)', 105, y, {align: 'center'});
    // ì„œëª…ì„ 
    doc.line(35, y + 5, 175, y + 5); // í•˜ë‚˜ì˜ ê¸´ ì„ 
    
    // í•˜ë‹¨ ë¬¸êµ¬ ì‚­ì œ (ì„¤ëª…ë¬¸ ì—†ìŒ)
    // PDF ì €ì¥
    const logoImg = 'data:image/png;base64,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';
    const imgWidth = 60; // mm (ê¸°ì¡´ 40)
    const imgHeight = 25; // mm (ê¸°ì¡´ 15)
    const pageHeight = doc.internal.pageSize.getHeight();
    doc.addImage(logoImg, 'PNG', 105 - imgWidth/2, pageHeight - imgHeight - 10, imgWidth, imgHeight);
    doc.save(`${inst.name}_Certificate.pdf`);
    console.log('í•œê¸€ PDF ìƒì„± ì™„ë£Œ');
}

// í—ˆìš©ì˜¤ì°¨ì—ì„œ ë‹¨ìœ„ ì¶”ì¶œ í•¨ìˆ˜
function extractUnitFromAllowError(allowError) {
    if (!allowError) return '';
    
    console.log('=== ë‹¨ìœ„ ì¶”ì¶œ ë””ë²„ê¹… ===');
    console.log('ì…ë ¥ê°’:', allowError);
    console.log('ì…ë ¥ê°’ ê¸¸ì´:', allowError.length);
    console.log('ì…ë ¥ê°’ ë¬¸ìì½”ë“œ:', Array.from(allowError).map(c => c.charCodeAt(0)));
    
    // ë‹¨ìœ„ ë§¤í•‘ í…Œì´ë¸”
    const unitMapping = {
        'kg/cm2': 'kg/cm2',
        'kg/m2': 'kg/m2', 
        'kg/m3': 'kg/m3',
        'g/cm3': 'g/cm3',
        'g/cm2': 'g/cm2',
        'g/m3': 'g/m3',
        'mmhg': 'mmhg',
        'mmHg': 'mmHg',
        'kPa': 'kPa',
        'Pa': 'Pa',
        '%': '%',
        '%FS': '%FS',
        'FS': 'FS'
    };
    
    // ì˜¨ë„ ë‹¨ìœ„ íŠ¹ë³„ ì²˜ë¦¬
    if (allowError.includes('â„ƒ')) {
        console.log('ì˜¨ë„ ë‹¨ìœ„ ì¶”ì¶œ: â„ƒ', 'ì›ë³¸:', allowError);
        return 'â„ƒ';  // ì›ë˜ ë‹¨ìœ„ ìœ ì§€
    }
    if (allowError.includes('C') || allowError.includes('c')) {
        console.log('ì˜¨ë„ ë‹¨ìœ„ ì¶”ì¶œ: C', 'ì›ë³¸:', allowError);
        return 'C';
    }
    
    // ë§¤í•‘ í…Œì´ë¸”ì—ì„œ ì°¾ê¸°
    for (const [key, value] of Object.entries(unitMapping)) {
        if (allowError.includes(key)) {
            console.log('ë§¤í•‘ëœ ë‹¨ìœ„:', value, 'ì›ë³¸:', allowError);
            return value;
        }
    }
    
    // ê¸°ë³¸ ì²˜ë¦¬: ìˆ«ìì™€ ê¸°í˜¸ ì œê±°
    let unit = allowError.replace(/[Â±\d\s\.]/g, '');
    
    // íŠ¹ìˆ˜ ìœ ë‹ˆì½”ë“œ ë¬¸ìë¥¼ ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ (PDF í˜¸í™˜ì„±)
    unit = unit.replace(/ã /g, 'cm2');
    unit = unit.replace(/ã¥/g, 'm3');
    unit = unit.replace(/ã¦/g, 'm3');
    
    console.log('ê¸°ë³¸ ì²˜ë¦¬ ë‹¨ìœ„:', unit, 'ì›ë³¸:', allowError);
    console.log('=== ë‹¨ìœ„ ì¶”ì¶œ ì™„ë£Œ ===');
    return unit;
}

// approveStatusRow í•¨ìˆ˜ ì¶”ê°€
function approveStatusRow(num) {
    const year = document.getElementById('status-year').value;
    const list = instrumentsByYear[year]||[];
    const idx = list.findIndex(inst=>inst.num===num);
    if(idx===-1) return;
    if(!list[idx].yearData) list[idx].yearData = {};
    if(!list[idx].yearData[year]) list[idx].yearData[year] = {};
    list[idx].yearData[year].approved = true;
    localStorage.setItem('instrumentsByYear', JSON.stringify(instrumentsByYear));
    alert('ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤! ë„ì¥ í¬í•¨ ì„±ì ì„œê°€ ìë™ ë°œê¸‰ë©ë‹ˆë‹¤.');
    generatePdfKoreanWithSeal(num); // ë„ì¥ í¬í•¨ PDF ìë™ ìƒì„±
    renderStatusList();
}

// ë„ì¥ í¬í•¨ ì„±ì ì„œ PDF ìƒì„± í•¨ìˆ˜
function generatePdfKoreanWithSeal(num) {
    // ë„ì¥ ì´ë¯¸ì§€ base64
    // ë„ì¥ ì´ë¯¸ì§€ base64
    const sealImg = 'data:image/png;base64,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';
    const logoImg = 'data:image/png;base64,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'; // ê¸°ì¡´ ë¡œê³  base64 ì „ì²´ ë³µì‚¬
    const year = document.getElementById('status-year').value;
    let allInstruments = [];
    Object.values(instrumentsByYear).forEach(yearArr => {
        allInstruments = allInstruments.concat(yearArr);
    });
    const inst = allInstruments.find(inst => inst.num === num);
    if (!inst) {
        alert('ê³„ì¸¡ê¸°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë²ˆí˜¸: ' + num);
        return;
    }
    const yearData = inst.yearData && inst.yearData[year];
    const calibDate = yearData ? yearData.calibDate : '';
    const maxError = yearData ? yearData.maxError : '';
    const result = yearData ? yearData.result : '';
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.addFileToVFS("NotoSansKR-VariableFont_wght-normal.ttf", font);
    doc.addFont("NotoSansKR-VariableFont_wght-normal.ttf", "NotoSansKR-VariableFont_wght", "normal");
    doc.setFont("NotoSansKR-VariableFont_wght");
    doc.setFontSize(20);
    doc.text('ê³„ì¸¡ê¸° ê²€êµì • ì„±ì ì„œ', 105, 30, { align: 'center' });
    const tableData = [
        ['ê³„ì¸¡ê¸°ëª…', inst.name],
        ['Service', inst.service],
        ['ê³„ì¸¡ê¸° ìœ í˜•', inst.type],
        ['êµì •ë²ˆí˜¸', inst.num],
        ['êµì •ì¼', inst.date],
        ['êµì •ì£¼ê¸°', inst.cycle + 'ë…„'],
        ['ì°¨ê¸° êµì • ì˜ˆì •ì¼', inst.nextDate],
        ['í—ˆìš©ì˜¤ì°¨', 'Â±' + inst.allowError + (inst.unit ? ' ' + inst.unit : '')],
        ['ê²€êµì •ì¼', calibDate || '-'],
        ['ìµœëŒ€ì˜¤ì°¨', maxError || '-'],
        ['ê²€êµì • ê²°ê³¼', result || '-']
    ];
    let y = 50;
    doc.setFontSize(12);
    doc.setFont('NotoSansKR-VariableFont_wght', 'normal');
    tableData.forEach((row, index) => {
        if (index % 2 === 0) {
            doc.setFillColor(248, 249, 250);
            doc.rect(20, y - 5, 170, 10, 'F');
        }
        doc.setFont('NotoSansKR-VariableFont_wght', 'normal');
        doc.text(row[0], 25, y);
        doc.setFont('NotoSansKR-VariableFont_wght', 'normal');
        doc.text(row[1], 120, y);
        y += 12;
        
    });
    
// ê¸°ì¤€ê°’/ì¸¡ì •ê°’ í‘œ
// ê¸°ì¤€ê°’/ì¸¡ì •ê°’ í‘œ (ì œëª© ì‚­ì œ)
// ë‹¨ìœ„ ì¶”ì¶œ
    let unit = '';
    if (inst.unit) {
        unit = inst.unit;
} else if (inst.allowError) {
        unit = extractUnitFromAllowError(inst.allowError);
}

// í‘œ ê·¸ë¦¬ê¸° (yê°’ ì¡°ì •)
    const tableX = 30;
    const tableY = y; // y += 10 ì‚­ì œí–ˆìœ¼ë¯€ë¡œ ê·¸ëŒ€ë¡œ ì‚¬ìš©
    const colWidth = 75;
    const rowHeight = 8;

// í‘œ ê·¸ë¦¬ê¸°
    doc.setDrawColor(100, 100, 100);
    doc.rect(tableX, tableY, colWidth * 2, rowHeight * 4);
    doc.setFont('NotoSansKR-VariableFont_wght', 'normal');
    doc.text('ê¸°ì¤€ê°’', tableX + colWidth/2, tableY + 5, {align: 'center'});
    doc.text('ì¸¡ì •ê°’', tableX + colWidth + colWidth/2, tableY + 5, {align: 'center'});
    doc.line(tableX + colWidth, tableY, tableX + colWidth, tableY + rowHeight * 4);
    for (let i = 1; i <= 3; i++) {
    doc.line(tableX, tableY + rowHeight * i, tableX + colWidth * 2, tableY + rowHeight * i);
}
    doc.setFont('NotoSansKR-VariableFont_wght', 'normal');
    doc.setFontSize(10);
    const std1 = (yearData && yearData.std1) || '';
    const meas1 = (yearData && yearData.meas1) || '';
    const std2 = (yearData && yearData.std2) || '';
    const meas2 = (yearData && yearData.meas2) || '';
    const std3 = (yearData && yearData.std3) || '';
    const meas3 = (yearData && yearData.meas3) || '';
    const formatWithUnit = (value, unit) => {
    if (!value) return '';
    if (!unit) return value;
    let displayUnit = unit;
    if (unit === 'â„ƒ') displayUnit = 'Â°C';
    return `${value} ${displayUnit}`;
};
    doc.text(formatWithUnit(std1, unit), tableX + colWidth/2, tableY + rowHeight + 5, {align: 'center'});
    doc.text(formatWithUnit(meas1, unit), tableX + colWidth + colWidth/2, tableY + rowHeight + 5, {align: 'center'});
    doc.text(formatWithUnit(std2, unit), tableX + colWidth/2, tableY + rowHeight * 2 + 5, {align: 'center'});
    doc.text(formatWithUnit(meas2, unit), tableX + colWidth + colWidth/2, tableY + rowHeight * 2 + 5, {align: 'center'});
    doc.text(formatWithUnit(std3, unit), tableX + colWidth/2, tableY + rowHeight * 3 + 5, {align: 'center'});
    doc.text(formatWithUnit(meas3, unit), tableX + colWidth + colWidth/2, tableY + rowHeight * 3 + 5, {align: 'center'});
    // (ì¸) ë¶€ë¶„ ë° ë„ì¥ ì´ë¯¸ì§€
    // í‘œ ì¶œë ¥ í›„ yê°’ì„ ë°˜ë“œì‹œ ì‚¬ìš©!
    y += rowHeight * 4 + 20; // í‘œ ì¶œë ¥ í›„ yê°’ ì¦ê°€(ì´ë¯¸ ìˆë‹¤ë©´ ì¤‘ë³µ ì¶”ê°€ X)

    // ì½˜ì†”ë¡œê·¸ ì¶”ê°€ (ë””ë²„ê¹…ìš©)
    console.log('í‘œ ì¶œë ¥ í›„ yê°’:', y);
    console.log('í‘œ ë†’ì´:', rowHeight * 4);

    // (ì¸) ë¬¸êµ¬ì™€ ë„ì¥ ìœ„ì¹˜ ê³„ì‚° (ê¸°ì¡´ ì½”ë“œ ëŒ€ì‹ )
    const signText = 'ê³„ì¸¡ê¸° ë‹´ë‹¹ íŒŒíŠ¸ì¥';
    const inText = '(ì¸)';
    const signTextWidth = doc.getTextWidth(signText);
    const inTextWidth = doc.getTextWidth(inText);
    const gap = 15; // â† ì—¬ë°±ì„ ë„‰ë„‰í•˜ê²Œ!
    const totalWidth = signTextWidth + inTextWidth + gap;
    const startX = 105 - totalWidth / 2;
    const signTextX = startX;
    const inX = signTextX + signTextWidth + gap;

    // ë¡œê³  ìœ„ì¹˜ (signY ê³„ì‚° ì „ì— ìœ„ì¹˜í•´ì•¼ í•¨)
    const imgWidth = 60;
    const imgHeight = 25;
    const pageHeight = doc.internal.pageSize.getHeight();
    const logoY = pageHeight - imgHeight - 10;

    // (ì¸) ë¬¸êµ¬ì™€ ë„ì¥ ìœ„ì¹˜ë¥¼ í‘œì™€ ë¡œê³  ì‚¬ì´ ì¤‘ê°„ì—!
    let signY = y + 50; // í‘œ ì•„ë˜ 50mm ìœ„ì¹˜ì— (ì¸) ë¬¸êµ¬

      // ë§Œì•½ signYê°€ ë¡œê³ ì™€ ë„ˆë¬´ ê°€ê¹Œìš°ë©´, ë¡œê³  ìœ„ë¡œ ì˜¬ë¦¼
    const minGap = 30; // (ì¸)~ë¡œê³  ìµœì†Œ ê°„ê²©
    if (signY + minGap > logoY) {
        signY = logoY - minGap;
}
    
    // ë„ì¥ ìœ„ì¹˜: (ì¸) ì¤‘ì•™ì— ì •í™•íˆ
    const sealWidth = 18;
    const sealHeight = 18;
    const sealX = inX + inTextWidth / 2 - sealWidth / 2;
    let sealY = signY - sealHeight / 2 -2;


    // ì½˜ì†”ë¡œê·¸ ì¶”ê°€ (ë””ë²„ê¹…ìš©)
    console.log('signY:', signY);
    console.log('sealX:', sealX);
    console.log('sealY:', sealY);
    console.log('logoY:', logoY);
    console.log('(ì¸) ê¸€ì ìœ„ì¹˜:', inX);

    // í‘œê°€ ê¸¸ì–´ì„œ (ì¸)/ë„ì¥/ë¡œê³ ê°€ ê²¹ì¹  ê²½ìš° ì¡°ì •
    if (sealY + sealHeight > logoY - 10) {
        console.log('ê²¹ì¹¨ ë°œìƒ! signY ì¡°ì •');
        signY = logoY - sealHeight - 40;
        sealY = signY - sealHeight / 2 - 1;
        console.log('ì¡°ì • í›„ signY:', signY);
        console.log('ì¡°ì • í›„ sealY:', sealY);
}

    // ì¶œë ¥ (ê¸°ì¡´ ì½”ë“œ ëŒ€ì‹ )
    doc.setFontSize(14);
    doc.setFont('NotoSansKR-VariableFont_wght', 'normal');
    doc.text(signText, signTextX, signY);
    doc.text(inText, inX, signY);
    doc.addImage(sealImg, 'PNG', sealX, sealY, sealWidth, sealHeight);
    doc.addImage(logoImg, 'PNG', 105 - imgWidth/2, logoY, imgWidth, imgHeight);
    doc.save('ê³„ì¸¡ê¸°_ê²€êµì •_ì„±ì ì„œ_' + inst.num + '.pdf');
}
</script>